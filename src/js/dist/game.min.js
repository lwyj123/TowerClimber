var Buffs=function(){var a=1,b=1,c=1,d=1,e=1,f=0,g=0,h=0,i=!1,j=!1,k=!1,l=0,m=0,n=0,o=this;o.save=function(){var o={savedExceliaMultiplier:a,savedSpellLevelingMultiplier:b,savedRestingMultiplier:c,savedLevelingSpeedMultiplier:d,savedExplorationSpeedMultiplier:e,savedManaPerSecond:f,savedExceliaSavedOnDeath:g,savedDeathPenaltyReduction:h,savedCastCureInBattle:i,savedCastFireballInBattle:j,savedAutoBarrierCast:k,savedAegisTimeLeft:l,savedRageTimeLeft:m,savedBarrierLeft:n};localStorage.setItem("buffsSave",JSON.stringify(o))},o.load=function(){var a=JSON.parse(localStorage.getItem("buffsSave"));a&&(p(a),q(a),r(a),s(a),t(a),u(a))};var p=function(f){void 0!==f.savedExceliaMultiplier&&(a=f.savedExceliaMultiplier),void 0!==f.savedSpellLevelingMultiplier&&(b=f.savedSpellLevelingMultiplier),void 0!==f.savedRestingMultiplier&&(c=f.savedRestingMultiplier),void 0!==f.savedLevelingSpeedMultiplier&&(d=f.savedLevelingSpeedMultiplier),void 0!==f.savedExplorationSpeedMultiplier&&(e=f.savedExplorationSpeedMultiplier)},q=function(a){void 0!==a.savedManaPerSecond&&(f=a.savedManaPerSecond)},r=function(a){void 0!==a.savedExceliaSavedOnDeath&&(g=a.savedExceliaSavedOnDeath),void 0!==a.deathPenaltyReduction&&(h=a.savedDeathPenaltyReduction)},s=function(a){void 0!==a.savedCastCureInBattle&&(i=a.savedCastCureInBattle),void 0!==a.savedCastFireballInBattle&&(j=a.savedCastFireballInBattle),void 0!==a.savedAutoBarrierCast&&(k=a.autoBarrierCast)},t=function(a){void 0!==a.savedAegisTimeLeft&&(l=a.savedAegisTimeLeft),void 0!==a.savedRageTimeLeft&&(m=a.savedRageTimeLeft)},u=function(a){void 0!==a.savedBarrierLeft&&(n=a.savedBarrierLeft)};o.getCastFireballInBattle=function(){return j},o.getRageTimeLeft=function(){return m},o.getSpellLevelingMultiplier=function(){return b},o.getBarrierLeft=function(){return n},o.getAegisTimeLeft=function(){return l},o.getCastCureInBattle=function(){return i},o.getExceliaMultiplier=function(){return a},o.getManaPerSecond=function(){return f},o.getExceliaSavedOnDeath=function(){return g},o.getRestingMultiplier=function(){return c},o.getDeathPenaltyReduction=function(){return h},o.getAutoBarrierCast=function(){return k},o.getLevelingSpeedMultiplier=function(){return d},o.getExplorationSpeedMultiplier=function(){return e},o.setBarrierLeft=function(a){n=a},o.setAegisTimeLeft=function(a){l=a},o.setRageTimeLeft=function(a){m=a},o.setManaPerSecond=function(a){f=a},o.setCastCureInBattle=function(a){i=a},o.setExceliaMultiplier=function(b){a=b},o.setSpellLevelingMultiplier=function(a){b=a},o.setExceliaSavedOnDeath=function(a){g=a},o.setCastFireballInBattle=function(a){j=a},o.setRestingMultiplier=function(a){c=a},o.setDeathPenaltyReduction=function(a){h=a},o.setAutoBarrierCast=function(a){k=a},o.setLevelingSpeedMultiplier=function(a){d=a},o.setExplorationSpeedMultiplier=function(a){e=a},o.updateTemporaryBuffs=function(a){document.getElementById("temporary").innerHTML="",0!==l&&(a&&l--,document.getElementById("temporary").innerHTML+='<li class="list-group-item list-group-item-info"><span class="badge">'+Math.round(l)+"</span>Aegis</li>"),0!==n&&(document.getElementById("temporary").innerHTML+='<li class="list-group-item list-group-item-info"><span class="badge">'+Math.round(n)+"</span>Barrier</li>"),0!==m&&(a&&m--,document.getElementById("temporary").innerHTML+='<li class="list-group-item list-group-item-info"><span class="badge">'+Math.round(m)+"</span>Rage</li>")},o.updateToggleableBuffs=function(){document.getElementById("toggleable").innerHTML="";var a;(j||upgrades.isUpgradePurchased("autoshoot"))&&(a=j?"ON":"OFF",document.getElementById("toggleable").innerHTML+='<button type="button" class="list-group-item" onClick="buffs.toggleBuff(\'castFireballInBattle\')"><span class="badge">'+a+"</span>Auto-Shooting</button>"),(i||upgrades.isUpgradePurchased("battlehealing"))&&(a=i?"ON":"OFF",document.getElementById("toggleable").innerHTML+='<button type="button" class="list-group-item" onClick="buffs.toggleBuff(\'castCureInBattle\')"><span class="badge">'+a+"</span>Battle Healing</button>"),(k||upgrades.isUpgradePurchased("barriercast"))&&(a=k?"ON":"OFF",document.getElementById("toggleable").innerHTML+='<button type="button" class="list-group-item" onClick="buffs.toggleBuff(\'autoBarrierCast\')"><span class="badge">'+a+"</span>Barrier Casting</button>")},o.updatePermanentBuffs=function(){document.getElementById("permanent").innerHTML="",0!==h&&(document.getElementById("permanent").innerHTML+='<li class="list-group-item"><span class="badge">'+h+"%</span>Death Penalty Reduction</li>"),1!==a&&(document.getElementById("permanent").innerHTML+='<li class="list-group-item"><span class="badge">x'+a+"</span>Excelia Gain</li>"),0!==g&&(document.getElementById("permanent").innerHTML+='<li class="list-group-item"><span class="badge">'+g+"%</span>Excelia Saved Upon Death</li>"),0!==f&&(document.getElementById("permanent").innerHTML+='<li class="list-group-item"><span class="badge">+'+f+"</span>Exploration Mana per Second</li>"),1!==e&&(document.getElementById("permanent").innerHTML+='<li class="list-group-item"><span class="badge">x'+e+"</span>Exploration Speed</li>"),1!==c&&(document.getElementById("permanent").innerHTML+='<li class="list-group-item"><span class="badge">x'+c+"</span>Rest Speed</li>"),1!==b&&(document.getElementById("permanent").innerHTML+='<li class="list-group-item"><span class="badge">x'+b+"</span>Spell Level Gain</li>"),1!==d&&(document.getElementById("permanent").innerHTML+='<li class="list-group-item"><span class="badge">x'+d+"</span>Stats Experience Gain</li>")},o.toggleBuff=function(a){"castCureInBattle"==a?i=!i:"castFireballInBattle"==a?j=!j:"autoBarrierCast"==a&&(k=!k),o.updateToggleableBuffs()}},buffs=new Buffs,Inventory=function(){var a,b,c,d=0,e=0,f=[],g=!1,h=this;h.save=function(){var g={savedGold:d,savedBag:f,savedKeys:e,savedEquippedWeapon:a,savedEquippedArmor:b,savedEquippedAccessory:c};localStorage.setItem("inventorySave",JSON.stringify(g))},h.load=function(){var f=JSON.parse(localStorage.getItem("inventorySave"));f&&(void 0!==f.savedGold&&(d=f.savedGold),void 0!==f.savedBag&&i(f.savedBag),void 0!==f.savedKeys&&(e=f.savedKeys),void 0!==f.savedEquippedWeapon&&(a=f.savedEquippedWeapon),void 0!==f.savedEquippedArmor&&(b=f.savedEquippedArmor),void 0!==f.savedEquippedAccessory&&(c=f.savedEquippedAccessory))};var i=function(a){for(var b=0;b<a.length;b++)f.push(a[b])};h.getGold=function(){return d},h.getKeys=function(){return e},h.getBag=function(){return f},h.setGold=function(a){d=a,h.updateInventoryHTML()},h.setKeys=function(a){e=a,h.updateInventoryHTML()},h.updateInventoryHTML=function(){document.getElementById("gold").innerHTML=d,document.getElementById("keys").innerHTML=e},h.updateInventory=function(a){h.updateShop(a),document.getElementById("inventory").innerHTML="";for(var b=0;b<50&&!(b>=f.length);b++)"chest"==f[b].type?j(f[b],b,g):"weapon"==f[b].type?k(f[b],b,g):"armor"==f[b].type?l(f[b],b,g):"crystal"==f[b].type&&m(f[b],b,g);$(document).ready(function(){$('[data-toggle="tooltip"]').tooltip({html:!0})})},h.updateShop=function(a){g=a,document.getElementById("sellbutton").innerHTML=g?'<button class="btn btn-block btn-success" onClick="inventory.updateInventory(false)">Exit Sell Mode</button>':'<button class="btn btn-block btn-success" onClick="inventory.updateInventory(true)">Enter Sell Mode</button>',document.getElementById("keyprice").innerHTML=100,document.getElementById("crystalprice").innerHTML=1e3};var j=function(a,b,c){var d="Chest rarity: "+a.rarity+"<br>The higher the rarity, the better the stats of the item inside will be.";if(c){var e=a.rarity;document.getElementById("inventory").innerHTML+='<button type="button" class="list-group-item list-group-item-success" data-toggle="tooltip" title="'+d+'" onClick="inventory.sell('+b+","+e+')"><span class="badge">'+e+"</span> "+a.name+"</button>"}else document.getElementById("inventory").innerHTML+='<button type="button" class="list-group-item" data-toggle="tooltip" title="'+d+'" onClick="inventory.openChest('+b+')"><span class="badge">Open</span> '+a.name+"</button>"},k=function(a,b,c){var d="Bonus STR: "+Math.round(100*a.damage*a.rarity)/100+"<br>Bonus DEX: "+Math.round(100*a.speed*a.rarity)/100+"<br>Bonus CON: "+Math.round(100*a.defense*a.rarity)/100+"<br>Bonus MGC: "+Math.round(100*a.magic*a.rarity)/100;if(c){var e=Math.round(5*(a.damage+a.speed+a.defense+a.magic)*a.rarity);document.getElementById("inventory").innerHTML+='<button type="button" class="list-group-item list-group-item-success" data-toggle="tooltip" title="'+d+'" onClick="inventory.sell('+b+","+e+')"><span class="badge">'+e+"</span>"+a.name+"</button>"}else document.getElementById("inventory").innerHTML+='<button type="button" class="list-group-item" data-toggle="tooltip" title="'+d+'" onClick="inventory.equipWeapon('+b+')"><span class="badge">Weapon</span>'+a.name+"</button>"},l=function(a,b,c){var d="Bonus CON: "+Math.round(100*a.defense*a.rarity)/100+"<br>Bonus SPD: "+Math.round(100*a.movement*a.rarity)/100+"<br>Bonus MGC: "+Math.round(100*a.magic*a.rarity)/100;if(c){var e=Math.round(10*(a.defense+a.movement+a.magic)*a.rarity);document.getElementById("inventory").innerHTML+='<button type="button" class="list-group-item list-group-item-success" data-toggle="tooltip" title="'+d+'" onClick="inventory.sell('+b+","+e+')"><span class="badge">'+e+"</span>"+a.name+"</button>"}else document.getElementById("inventory").innerHTML+='<button type="button" class="list-group-item" data-toggle="tooltip" title="'+d+'" onClick="inventory.equipArmor('+b+')"><span class="badge">Armor</span>'+a.name+"</button>"},m=function(a,b,c){var d="This crystal will grant "+a.experience+" experience in "+a.stat+".";if(c){var e=Math.round(a.experience/2);document.getElementById("inventory").innerHTML+='<button type="button" class="list-group-item list-group-item-success" data-toggle="tooltip" title="'+d+'" onClick="inventory.sell('+b+","+e+')"><span class="badge">'+e+"</span>"+a.stat+" Experience Crystal</button>"}else document.getElementById("inventory").innerHTML+='<button type="button" class="list-group-item" data-toggle="tooltip" title="'+d+'" onClick="inventory.useCrystal('+b+')"><span class="badge">Crystal</span>'+a.stat+" Experience Crystal</button>"};h.updateEquipment=function(){document.getElementById("equipment").innerHTML="",void 0!==a&&n(),void 0!==b&&o(),$(document).ready(function(){$('[data-toggle="tooltip"]').tooltip({html:!0})})};var n=function(){var b="Bonus STR: "+Math.round(100*a.damage*a.rarity)/100+"<br>Bonus DEX: "+Math.round(100*a.speed*a.rarity)/100+"<br>Bonus CON: "+Math.round(100*a.defense*a.rarity)/100+"<br>Bonus MGC: "+Math.round(100*a.magic*a.rarity)/100;document.getElementById("equipment").innerHTML+='<button type="button" class="list-group-item" data-toggle="tooltip" title="'+b+'" onClick="inventory.unequipWeapon()"><span class="badge">Equipped</span>'+a.name+"</button>"},o=function(){var a="Bonus CON: "+Math.round(100*b.defense*b.rarity)/100+"<br>Bonus SPD: "+Math.round(100*b.movement*b.rarity)/100+"<br>Bonus MGC: "+Math.round(100*b.magic*b.rarity)/100;document.getElementById("equipment").innerHTML+='<button type="button" class="list-group-item" data-toggle="tooltip" title="'+a+'" onClick="inventory.unequipArmor()"><span class="badge">Equipped</span>'+b.name+"</button>"};h.openChest=function(a){if(e>0){var b=Math.floor(2*Math.random());0===b?f.push(p(f[a].rarity)):1===b?f.push(q(f[a].rarity)):2==b?createAcessory(f[a].rarity):3==b&&createEnhancingStone(f[a].rarity),f.splice(a,1),h.updateInventory(g),h.setKeys(e-1)}};var p=function(a){for(var b,c={type:"weapon",name:"",damage:0,speed:0,defense:0,magic:0,rarity:0};a>0;)b=Math.floor(4*Math.random()),0===b?c.damage+=.1*Math.round(a/2):1==b?c.speed+=.1*Math.round(a/2):2==b?c.defense+=.1*Math.round(a/2):3==b&&(c.magic+=.1*Math.round(a/2)),a-=Math.round(a/2);return c.rarity=r(),c.name=s(c),c},q=function(a){for(var b,c={type:"armor",name:"",defense:0,movement:0,magic:0,rarity:0};a>0;)b=Math.floor(3*Math.random()),0===b?c.defense+=.1*Math.round(a/2):1==b?c.movement+=.1*Math.round(a/2):2==b&&(c.movement+=.1*Math.round(a/2)),a-=Math.round(a/2);return c.rarity=r(),c.name=t(c),c},r=function(){return Math.floor(101*Math.random())},s=function(a){var b="",c=Math.max(a.damage,a.speed,a.defense,a.magic);return b+=u(a),b+=v(c),c==a.damage?b+="Sword":c==a.speed?b+="Daggers":c==a.defense?b+="Shield":c==a.magic&&(b+="Staff"),b},t=function(a){var b="",c=Math.max(a.defense,a.movement,a.magic);return b+=u(a),c==a.defense?(b+=w(a.defense),b+="Plate Armor"):c==a.movement?(b+=x(a.movement),b+="Leather Vest"):c==a.magic&&(b+=y(a.magic),b+="Cloth Robe"),b},u=function(a){return a.rarity<50?(a.rarity=1,""):a.rarity<75?(a.rarity=1.25,"Uncommon "):a.rarity<90?(a.rarity=1.5,"Rare "):a.rarity<100?(a.rarity=2,"Epic "):100==a.rarity?(a.rarity=2.5,"Legendary "):void 0},v=function(a){var b="";return a*=10,console.log(a),b+=z(a%10),a<10?b+="Wooden ":a<20?b+="Copper ":a<30?b+="Iron ":a<40&&(b+="Steel "),b},w=function(a){var b="";return a*=10,console.log(a),b+=z(a%10),a<10?b+="Makeshift ":a<20?b+="Copper ":a<30?b+="Iron ":a<40&&(b+="Steel "),b},x=function(a){var b="";return a*=10,console.log(a),b+=z(a%10),a<10?b+="Uncomfortable ":a<20?b+="Light ":a<30?b+="Heavy ":a<40&&(b+="Resistant "),b},y=function(a){var b="";return a*=10,console.log(a),b+=z(a%10),a<10?b+="Useless ":a<20?b+="Cotton ":a<30?b+="Eerie ":a<40&&(b+="Magical "),b},z=function(a){return a<3?"Weak ":a<6?"Regular ":a<9?"Strong ":"Pristine "};h.findChest=function(a){var b={type:"chest",name:"",rarity:a};b.name=A(b)+" Chest",f.push(b),h.updateInventory(g)},h.clearBag=function(){f=[],h.updateInventory(g)};var A=function(a){var b="";return b+=B(a),a.rarity<5?b+="Useless":a.rarity<10?b+="Dusty":a.rarity<25?b+="Rusty":a.rarity<50?b+="Shabby":a.rarity<100?b+="Common":a.rarity<250&&(b+="Odd"),b},B=function(a){var b=Math.floor(101*Math.random());return b<50?"Poor ":b<75?(a.rarity+=2,"Regular "):b<90?(a.rarity+=5,"Shiny "):b<100?(a.rarity+=10,"Aetherial "):100==b?(a.rarity+=20,"Heavenly "):void 0};h.equipWeapon=function(b){var c=f[b];void 0!==a&&h.unequipWeapon(),a=c,player.setStrengthBonus(player.getStrengthBonus()+c.damage*c.rarity),player.setDexterityBonus(player.getDexterityBonus()+c.speed*c.rarity),player.setConstitutionBonus(player.getConstitutionBonus()+c.defense*c.rarity),player.setMagicBonus(player.getMagicBonus()+c.magic*c.rarity),f.splice(b,1),h.updateInventory(g),h.updateEquipment()},h.equipArmor=function(a){var c=f[a];void 0!==b&&h.unequipArmor(),b=c,player.setConstitutionBonus(player.getConstitutionBonus()+c.defense*c.rarity),player.setSpeedBonus(player.getSpeedBonus()+c.movement*c.rarity),player.setMagicBonus(player.getMagicBonus()+c.magic*c.rarity),f.splice(a,1),h.updateInventory(g),h.updateEquipment()},h.unequipWeapon=function(){f.push(a),player.setStrengthBonus(player.getStrengthBonus()-a.damage*a.rarity),player.setDexterityBonus(player.getDexterityBonus()-a.speed*a.rarity),player.setConstitutionBonus(player.getConstitutionBonus()-a.defense*a.rarity),player.setMagicBonus(player.getMagicBonus()-a.magic*a.rarity),player.setHealthCurrentValue(player.getHealthCurrentValue()),player.setManaCurrentValue(player.getManaCurrentValue()),a=void 0,h.updateEquipment(),h.updateInventory(g)},h.unequipArmor=function(){f.push(b),player.setConstitutionBonus(player.getConstitutionBonus()-b.defense*b.rarity),player.setSpeedBonus(player.getSpeedBonus()-b.movement*b.rarity),player.setMagicBonus(player.getMagicBonus()-b.magic*b.rarity),player.setHealthCurrentValue(player.getHealthCurrentValue()),player.setManaCurrentValue(player.getManaCurrentValue()),b=void 0,h.updateEquipment(),h.updateInventory(g)},h.createCrystal=function(a,b){f.push({type:"crystal",stat:a,experience:b})},h.useCrystal=function(a,b){var c=f[a];"Strength"==c.stat?player.setStrengthExperience(player.getStrengthExperience()+c.experience):"Dexterity"==c.stat?player.setDexterityExperience(player.getDexterityExperience()+c.experience):"Constitution"==c.stat?player.setConstitutionExperience(player.getConstitutionExperience()+c.experience):"Speed"==c.stat?player.setSpeedExperience(player.getSpeedExperience()+c.experience):"Magic"==c.stat&&player.setMagicExperience(player.getMagicExperience()+c.experience),f.splice(a,1),void 0===b&&h.updateInventory(g)},h.buyKey=function(){d>=100&&(h.setGold(h.getGold()-100),h.setKeys(h.getKeys()+1),h.updateInventory(g))},h.buyCrystal=function(a){var b=1e3;if(""===a){b/=2;var c=Math.floor(5*Math.random());0===c?a="Strength":1==c?a="Dexterity":2==c?a="Constitution":3==c?a="Speed":4==c&&(a="Magic")}d>=b&&(h.setGold(h.getGold()-b),h.createCrystal(a,1e3),h.updateInventory(g))},h.sell=function(a,b){h.setGold(h.getGold()+b),f.splice(a,1),h.updateInventory(g)},h.useAllCrystals=function(){for(var a=f.length-1;a>=0;a--)"crystal"==f[a].type&&h.useCrystal(a,!0);h.updateInventory(g)}},inventory=new Inventory;!function(a){function b(){return"Markdown.mk_block( "+uneval(this.toString())+", "+uneval(this.trailing)+", "+uneval(this.lineNumber)+" )"}function c(){var a=require("util");return"Markdown.mk_block( "+a.inspect(this.toString())+", "+a.inspect(this.trailing)+", "+a.inspect(this.lineNumber)+" )"}function d(a){for(var b=0,c=-1;-1!==(c=a.indexOf("\n",c+1));)b++;return b}function e(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function f(a){if("string"==typeof a)return e(a);var b=a.shift(),c={},d=[];for(!a.length||"object"!=typeof a[0]||a[0]instanceof Array||(c=a.shift());a.length;)d.push(f(a.shift()));var g="";for(var h in c)g+=" "+h+'="'+e(c[h])+'"';return"img"===b||"br"===b||"hr"===b?"<"+b+g+"/>":"<"+b+g+">"+d.join("")+"</"+b+">"}function g(a,b,c){var d;c=c||{};var e=a.slice(0);"function"==typeof c.preprocessTreeNode&&(e=c.preprocessTreeNode(e,b));var f=o(e);if(f){e[1]={};for(d in f)e[1][d]=f[d];f=e[1]}if("string"==typeof e)return e;switch(e[0]){case"header":e[0]="h"+e[1].level,delete e[1].level;break;case"bulletlist":e[0]="ul";break;case"numberlist":e[0]="ol";break;case"listitem":e[0]="li";break;case"para":e[0]="p";break;case"markdown":e[0]="html",f&&delete f.references;break;case"code_block":e[0]="pre",d=f?2:1;var h=["code"];h.push.apply(h,e.splice(d,e.length-d)),e[d]=h;break;case"inlinecode":e[0]="code";break;case"img":e[1].src=e[1].href,delete e[1].href;break;case"linebreak":e[0]="br";break;case"link":e[0]="a";break;case"link_ref":e[0]="a";var i=b[f.ref];if(!i)return f.original;delete f.ref,f.href=i.href,i.title&&(f.title=i.title),delete f.original;break;case"img_ref":e[0]="img";var i=b[f.ref];if(!i)return f.original;delete f.ref,f.src=i.href,i.title&&(f.title=i.title),delete f.original}if(d=1,f){for(var j in e[1]){d=2;break}1===d&&e.splice(d,1)}for(;d<e.length;++d)e[d]=g(e[d],b,c);return e}function h(a){for(var b=o(a)?2:1;b<a.length;)"string"==typeof a[b]?b+1<a.length&&"string"==typeof a[b+1]?a[b]+=a.splice(b+1,1)[0]:++b:(h(a[b]),++b)}function i(a,b){function c(a){this.len_after=a,this.name="close_"+b}var d=a+"_state",e="strong"===a?"em_state":"strong_state";return function(f){if(this[d][0]===b)return this[d].shift(),[f.length,new c(f.length-b.length)];var g=this[e].slice(),h=this[d].slice();this[d].unshift(b);var i=this.processInline(f.substr(b.length)),j=i[i.length-1];this[d].shift();if(j instanceof c){i.pop();return[f.length-j.len_after,[a].concat(i)]}return this[e]=g,this[d]=h,[b.length,b]}}function j(a){for(var b=a.split(""),c=[""],d=!1;b.length;){var e=b.shift();switch(e){case" ":d?c[c.length-1]+=e:c.push("");break;case"'":case'"':d=!d;break;case"\\":e=b.shift();default:c[c.length-1]+=e}}return c}var k={};k.mk_block=function(a,d,e){1===arguments.length&&(d="\n\n");var f=new String(a);return f.trailing=d,f.inspect=c,f.toSource=b,void 0!==e&&(f.lineNumber=e),f};var l=k.isArray=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)};Array.prototype.forEach?k.forEach=function(a,b,c){return a.forEach(b,c)}:k.forEach=function(a,b,c){for(var d=0;d<a.length;d++)b.call(c||a,a[d],d,a)},k.isEmpty=function(a){for(var b in a)if(hasOwnProperty.call(a,b))return!1;return!0},k.extract_attr=function(a){return l(a)&&a.length>1&&"object"==typeof a[1]&&!l(a[1])?a[1]:void 0};var m=function(a){switch(typeof a){case"undefined":this.dialect=m.dialects.Gruber;break;case"object":this.dialect=a;break;default:if(!(a in m.dialects))throw new Error("Unknown Markdown dialect '"+String(a)+"'");this.dialect=m.dialects[a]}this.em_state=[],this.strong_state=[],this.debug_indent=""};m.dialects={};var n=m.mk_block=k.mk_block,l=k.isArray;m.parse=function(a,b){return new m(b).toTree(a)},m.prototype.split_blocks=function(a){a=a.replace(/(\r\n|\n|\r)/g,"\n");var b,c=/([\s\S]+?)($|\n#|\n(?:\s*\n|$)+)/g,e=[],f=1;for(null!==(b=/^(\s*\n)/.exec(a))&&(f+=d(b[0]),c.lastIndex=b[0].length);null!==(b=c.exec(a));)"\n#"===b[2]&&(b[2]="\n",c.lastIndex--),e.push(n(b[1],b[2],f)),f+=d(b[0]);return e},m.prototype.processBlock=function(a,b){var c=this.dialect.block,d=c.__order__;if("__call__"in c)return c.__call__.call(this,a,b);for(var e=0;e<d.length;e++){var f=c[d[e]].call(this,a,b);if(f)return(!l(f)||f.length>0&&!l(f[0]))&&this.debug(d[e],"didn't return a proper array"),f}return[]},m.prototype.processInline=function(a){return this.dialect.inline.__call__.call(this,String(a))},m.prototype.toTree=function(a,b){var c=a instanceof Array?a:this.split_blocks(a),d=this.tree;try{for(this.tree=b||this.tree||["markdown"];c.length;){var e=this.processBlock(c.shift(),c);e.length&&this.tree.push.apply(this.tree,e)}return this.tree}finally{b&&(this.tree=d)}},m.prototype.debug=function(){var a=Array.prototype.slice.call(arguments);a.unshift(this.debug_indent),"undefined"!=typeof print&&print.apply(print,a),"undefined"!=typeof console&&void 0!==console.log&&console.log.apply(null,a)},m.prototype.loop_re_over_block=function(a,b,c){for(var d,e=b.valueOf();e.length&&null!==(d=a.exec(e));)e=e.substr(d[0].length),c.call(this,d);return e},m.buildBlockOrder=function(a){var b=[];for(var c in a)"__order__"!==c&&"__call__"!==c&&b.push(c);a.__order__=b},m.buildInlinePatterns=function(a){var b=[];for(var c in a)if(!c.match(/^__.*__$/)){var d=c.replace(/([\\.*+?|()\[\]{}])/g,"\\$1").replace(/\n/,"\\n");b.push(1===c.length?d:"(?:"+d+")")}b=b.join("|"),a.__patterns__=b;var e=a.__call__;a.__call__=function(a,c){return void 0!==c?e.call(this,a,c):e.call(this,a,b)}};var o=k.extract_attr;m.renderJsonML=function(a,b){b=b||{},b.root=b.root||!1;var c=[];if(b.root)c.push(f(a));else for(a.shift(),!a.length||"object"!=typeof a[0]||a[0]instanceof Array||a.shift();a.length;)c.push(f(a.shift()));return c.join("\n\n")},m.toHTMLTree=function(a,b,c){"string"==typeof a&&(a=this.parse(a,b));var d=o(a),e={};d&&d.references&&(e=d.references);var f=g(a,e,c);return h(f),f},m.toHTML=function(a,b,c){var d=this.toHTMLTree(a,b,c);return this.renderJsonML(d)};var p={};p.inline_until_char=function(a,b){for(var c=0,d=[];;){if(a.charAt(c)===b)return c++,[c,d];if(c>=a.length)return null;var e=this.dialect.inline.__oneElement__.call(this,a.substr(c));c+=e[0],d.push.apply(d,e.slice(1))}},p.subclassDialect=function(a){function b(){}function c(){}return b.prototype=a.block,c.prototype=a.inline,{block:new b,inline:new c}};var q=k.forEach,o=k.extract_attr,n=k.mk_block,r=k.isEmpty,s=p.inline_until_char,t={block:{atxHeader:function(a,b){var c=a.match(/^(#{1,6})\s*(.*?)\s*#*\s*(?:\n|$)/);if(c){var d=["header",{level:c[1].length}];return Array.prototype.push.apply(d,this.processInline(c[2])),c[0].length<a.length&&b.unshift(n(a.substr(c[0].length),a.trailing,a.lineNumber+2)),[d]}},setextHeader:function(a,b){var c=a.match(/^(.*)\n([-=])\2\2+(?:\n|$)/);if(c){var d="="===c[2]?1:2,e=["header",{level:d},c[1]];return c[0].length<a.length&&b.unshift(n(a.substr(c[0].length),a.trailing,a.lineNumber+2)),[e]}},code:function(a,b){var c=[],d=/^(?: {0,3}\t| {4})(.*)\n?/;if(a.match(d)){a:for(;;){var e=this.loop_re_over_block(d,a.valueOf(),function(a){c.push(a[1])});if(e.length){b.unshift(n(e,a.trailing));break a}if(!b.length)break a;if(!b[0].match(d))break a;c.push(a.trailing.replace(/[^\n]/g,"").substring(2)),a=b.shift()}return[["code_block",c.join("\n")]]}},horizRule:function(a,b){var c=a.match(/^(?:([\s\S]*?)\n)?[ \t]*([-_*])(?:[ \t]*\2){2,}[ \t]*(?:\n([\s\S]*))?$/);if(c){var d=[["hr"]];if(c[1]){var e=n(c[1],"",a.lineNumber);d.unshift.apply(d,this.toTree(e,[]))}return c[3]&&b.unshift(n(c[3],a.trailing,a.lineNumber+1)),d}},lists:function(){function a(a){return new RegExp("(?:^("+i+"{0,"+a+"} {0,3})("+f+")\\s+)|(^"+i+"{0,"+(a-1)+"}[ ]{0,4})")}function b(a){return a.replace(/ {0,3}\t/g,"    ")}function c(a,b,c,d){if(b)return void a.push(["para"].concat(c));var e=a[a.length-1]instanceof Array&&"para"===a[a.length-1][0]?a[a.length-1]:a;d&&a.length>1&&c.unshift(d);for(var f=0;f<c.length;f++){var g=c[f];"string"==typeof g&&e.length>1&&"string"==typeof e[e.length-1]?e[e.length-1]+=g:e.push(g)}}function d(a,b){for(var c=new RegExp("^("+i+"{"+a+"}.*?\\n?)*$"),d=new RegExp("^"+i+"{"+a+"}","gm"),e=[];b.length>0&&c.exec(b[0]);){var f=b.shift(),g=f.replace(d,"");e.push(n(g,f.trailing,f.lineNumber))}return e}function e(a,b,c){var d=a.list,e=d[d.length-1];if(!(e[1]instanceof Array&&"para"===e[1][0]))if(b+1===c.length)e.push(["para"].concat(e.splice(1,e.length-1)));else{var f=e.pop();e.push(["para"].concat(e.splice(1,e.length-1)),f)}}var f="[*+-]|\\d+\\.",g=/[*+-]/,h=new RegExp("^( {0,3})("+f+")[ \t]+"),i="(?: {0,3}\\t| {4})";return function(f,i){function j(a){var b=g.exec(a[2])?["bulletlist"]:["numberlist"];return n.push({list:b,indent:a[1]}),b}var k=f.match(h);if(k){for(var l,m,n=[],o=j(k),p=!1,r=[n[0].list];;){for(var s=f.split(/(?=\n)/),t="",u="",v=0;v<s.length;v++){u="";var w=s[v].replace(/^\n/,function(a){return u=a,""}),x=a(n.length);if(k=w.match(x),void 0!==k[1]){t.length&&(c(l,p,this.processInline(t),u),p=!1,t=""),k[1]=b(k[1]);var y=Math.floor(k[1].length/4)+1;if(y>n.length)o=j(k),l.push(o),l=o[1]=["listitem"];else{var z=!1;for(m=0;m<n.length;m++)if(n[m].indent===k[1]){o=n[m].list,n.splice(m+1,n.length-(m+1)),z=!0;break}z||(y++,y<=n.length?(n.splice(y,n.length-y),o=n[y-1].list):(o=j(k),l.push(o))),l=["listitem"],o.push(l)}u=""}w.length>k[0].length&&(t+=u+w.substr(k[0].length))}t.length&&(c(l,p,this.processInline(t),u),p=!1,t="");var A=d(n.length,i);A.length>0&&(q(n,e,this),l.push.apply(l,this.toTree(A,[])));var B=i[0]&&i[0].valueOf()||"";if(!B.match(h)&&!B.match(/^ /))break;f=i.shift();var C=this.dialect.block.horizRule(f,i);if(C){r.push.apply(r,C);break}q(n,e,this),p=!0}return r}}}(),blockquote:function(a,b){if(a.match(/^>/m)){var c=[];if(">"!==a[0]){for(var d=a.split(/\n/),e=[],f=a.lineNumber;d.length&&">"!==d[0][0];)e.push(d.shift()),f++;var g=n(e.join("\n"),"\n",a.lineNumber);c.push.apply(c,this.processBlock(g,[])),a=n(d.join("\n"),a.trailing,f)}for(;b.length&&">"===b[0][0];){var h=b.shift();a=n(a+a.trailing+h,h.trailing,a.lineNumber)}var i=a.replace(/^> ?/gm,""),j=(this.tree,this.toTree(i,["blockquote"])),k=o(j);return k&&k.references&&(delete k.references,r(k)&&j.splice(1,1)),c.push(j),c}},referenceDefn:function(a,b){var c=/^\s*\[(.*?)\]:\s*(\S+)(?:\s+(?:(['"])(.*?)\3|\((.*?)\)))?\n?/;if(a.match(c)){o(this.tree)||this.tree.splice(1,0,{});var d=o(this.tree);void 0===d.references&&(d.references={});var e=this.loop_re_over_block(c,a,function(a){a[2]&&"<"===a[2][0]&&">"===a[2][a[2].length-1]&&(a[2]=a[2].substring(1,a[2].length-1));var b=d.references[a[1].toLowerCase()]={href:a[2]};void 0!==a[4]?b.title=a[4]:void 0!==a[5]&&(b.title=a[5])});return e.length&&b.unshift(n(e,a.trailing)),[]}},para:function(a){return[["para"].concat(this.processInline(a))]}},inline:{__oneElement__:function(a,b,c){var d,e;if(b=b||this.dialect.inline.__patterns__,!(d=new RegExp("([\\s\\S]*?)("+(b.source||b)+")").exec(a)))return[a.length,a];if(d[1])return[d[1].length,d[1]];var e;return d[2]in this.dialect.inline&&(e=this.dialect.inline[d[2]].call(this,a.substr(d.index),d,c||[])),e=e||[d[2].length,d[2]]},__call__:function(a,b){function c(a){"string"==typeof a&&"string"==typeof e[e.length-1]?e[e.length-1]+=a:e.push(a)}for(var d,e=[];a.length>0;)d=this.dialect.inline.__oneElement__.call(this,a,b,e),a=a.substr(d.shift()),q(d,c);return e},"]":function(){},"}":function(){},__escape__:/^\\[\\`\*_{}\[\]()#\+.!\-]/,"\\":function(a){return this.dialect.inline.__escape__.exec(a)?[2,a.charAt(1)]:[1,"\\"]},"![":function(a){var b=a.match(/^!\[(.*?)\][ \t]*\([ \t]*([^")]*?)(?:[ \t]+(["'])(.*?)\3)?[ \t]*\)/);if(b){b[2]&&"<"===b[2][0]&&">"===b[2][b[2].length-1]&&(b[2]=b[2].substring(1,b[2].length-1)),b[2]=this.dialect.inline.__call__.call(this,b[2],/\\/)[0];var c={alt:b[1],href:b[2]||""};return void 0!==b[4]&&(c.title=b[4]),[b[0].length,["img",c]]}return b=a.match(/^!\[(.*?)\][ \t]*\[(.*?)\]/),b?[b[0].length,["img_ref",{alt:b[1],ref:b[2].toLowerCase(),original:b[0]}]]:[2,"!["]},"[":function(a){var b=String(a),c=s.call(this,a.substr(1),"]");if(!c)return[1,"["];var d,e,f=1+c[0],g=c[1];a=a.substr(f);var h=a.match(/^\s*\([ \t]*([^"']*)(?:[ \t]+(["'])(.*?)\2)?[ \t]*\)/);if(h){var i=h[1];if(f+=h[0].length,i&&"<"===i[0]&&">"===i[i.length-1]&&(i=i.substring(1,i.length-1)),!h[3])for(var j=1,k=0;k<i.length;k++)switch(i[k]){case"(":j++;break;case")":0==--j&&(f-=i.length-k,i=i.substring(0,k))}return i=this.dialect.inline.__call__.call(this,i,/\\/)[0],e={href:i||""},void 0!==h[3]&&(e.title=h[3]),d=["link",e].concat(g),[f,d]}return h=a.match(/^\s*\[(.*?)\]/),h?(f+=h[0].length,e={ref:(h[1]||String(g)).toLowerCase(),original:b.substr(0,f)},d=["link_ref",e].concat(g),[f,d]):1===g.length&&"string"==typeof g[0]?(e={ref:g[0].toLowerCase(),original:b.substr(0,f)},d=["link_ref",e,g[0]],[f,d]):[1,"["]},"<":function(a){var b;return null!==(b=a.match(/^<(?:((https?|ftp|mailto):[^>]+)|(.*?@.*?\.[a-zA-Z]+))>/))?b[3]?[b[0].length,["link",{href:"mailto:"+b[3]},b[3]]]:"mailto"===b[2]?[b[0].length,["link",{href:b[1]},b[1].substr("mailto:".length)]]:[b[0].length,["link",{href:b[1]},b[1]]]:[1,"<"]},"`":function(a){var b=a.match(/(`+)(([\s\S]*?)\1)/);return b&&b[2]?[b[1].length+b[2].length,["inlinecode",b[3]]]:[1,"`"]},"  \n":function(){return[3,["linebreak"]]}}};t.inline["**"]=i("strong","**"),t.inline.__=i("strong","__"),t.inline["*"]=i("em","*"),t.inline._=i("em","_"),m.dialects.Gruber=t,m.buildBlockOrder(m.dialects.Gruber.block),m.buildInlinePatterns(m.dialects.Gruber.inline);var u=p.subclassDialect(t),o=k.extract_attr,q=k.forEach;u.processMetaHash=function(a){for(var b=j(a),c={},d=0;d<b.length;++d)if(/^#/.test(b[d]))c.id=b[d].substring(1);else if(/^\./.test(b[d]))c.class?c.class=c.class+b[d].replace(/./," "):c.class=b[d].substring(1);else if(/\=/.test(b[d])){var e=b[d].split(/\=/);c[e[0]]=e[1]}return c},u.block.document_meta=function(a){if(!(a.lineNumber>1)&&a.match(/^(?:\w+:.*\n)*\w+:.*$/)){o(this.tree)||this.tree.splice(1,0,{});var b=a.split(/\n/);for(var c in b){var d=b[c].match(/(\w+):\s*(.*)$/),e=d[1].toLowerCase(),f=d[2];this.tree[1][e]=f}return[]}},u.block.block_meta=function(a){var b=a.match(/(^|\n) {0,3}\{:\s*((?:\\\}|[^\}])*)\s*\}$/);if(b){var c,d=this.dialect.processMetaHash(b[2]);if(""===b[1]){var e=this.tree[this.tree.length-1];if(c=o(e),"string"==typeof e)return;c||(c={},e.splice(1,0,c));for(var f in d)c[f]=d[f];return[]}var g=a.replace(/\n.*$/,""),h=this.processBlock(g,[]);c=o(h[0]),c||(c={},h[0].splice(1,0,c));for(var f in d)c[f]=d[f];return h}},u.block.definition_list=function(a,b){var c,d,e=/^((?:[^\s:].*\n)+):\s+([\s\S]+)$/,f=["dl"];if(d=a.match(e)){for(var g=[a];b.length&&e.exec(b[0]);)g.push(b.shift());for(var h=0;h<g.length;++h){var d=g[h].match(e),i=d[1].replace(/\n$/,"").split(/\n/),j=d[2].split(/\n:\s+/);for(c=0;c<i.length;++c)f.push(["dt",i[c]]);for(c=0;c<j.length;++c)f.push(["dd"].concat(this.processInline(j[c].replace(/(\n)\s+/,"$1"))))}return[f]}},u.block.table=function(a){var b,c,d=function(a,b){b=b||"\\s",b.match(/^[\\|\[\]{}?*.+^$]$/)&&(b="\\"+b);for(var c,d=[],e=new RegExp("^((?:\\\\.|[^\\\\"+b+"])*)"+b+"(.*)");c=a.match(e);)d.push(c[1]),a=c[2];return d.push(a),d}
;if(c=a.match(/^ {0,3}\|(.+)\n {0,3}\|\s*([\-:]+[\-| :]*)\n((?:\s*\|.*(?:\n|$))*)(?=\n|$)/))c[3]=c[3].replace(/^\s*\|/gm,"");else if(!(c=a.match(/^ {0,3}(\S(?:\\.|[^\\|])*\|.*)\n {0,3}([\-:]+\s*\|[\-| :]*)\n((?:(?:\\.|[^\\|])*\|.*(?:\n|$))*)(?=\n|$)/)))return;var e=["table",["thead",["tr"]],["tbody"]];c[2]=c[2].replace(/\|\s*$/,"").split("|");var f=[];for(q(c[2],function(a){a.match(/^\s*-+:\s*$/)?f.push({align:"right"}):a.match(/^\s*:-+\s*$/)?f.push({align:"left"}):a.match(/^\s*:-+:\s*$/)?f.push({align:"center"}):f.push({})}),c[1]=d(c[1].replace(/\|\s*$/,""),"|"),b=0;b<c[1].length;b++)e[1][1].push(["th",f[b]||{}].concat(this.processInline(c[1][b].trim())));return q(c[3].replace(/\|\s*$/gm,"").split("\n"),function(a){var c=["tr"];for(a=d(a,"|"),b=0;b<a.length;b++)c.push(["td",f[b]||{}].concat(this.processInline(a[b].trim())));e[2].push(c)},this),[e]},u.inline["{:"]=function(a,b,c){if(!c.length)return[2,"{:"];var d=c[c.length-1];if("string"==typeof d)return[2,"{:"];var e=a.match(/^\{:\s*((?:\\\}|[^\}])*)\s*\}/);if(!e)return[2,"{:"];var f=this.dialect.processMetaHash(e[1]),g=o(d);g||(g={},d.splice(1,0,g));for(var h in f)g[h]=f[h];return[e[0].length,""]},m.dialects.Maruku=u,m.dialects.Maruku.inline.__escape__=/^\\[\\`\*_{}\[\]()#\+.!\-|:]/,m.buildBlockOrder(m.dialects.Maruku.block),m.buildInlinePatterns(m.dialects.Maruku.inline),a.Markdown=m,a.parse=m.parse,a.toHTML=m.toHTML,a.toHTMLTree=m.toHTMLTree,a.renderJsonML=m.renderJsonML}(function(){return window.markdown={},window.markdown}()),function(a){function b(){return"Markdown.mk_block( "+uneval(this.toString())+", "+uneval(this.trailing)+", "+uneval(this.lineNumber)+" )"}function c(){var a=require("util");return"Markdown.mk_block( "+a.inspect(this.toString())+", "+a.inspect(this.trailing)+", "+a.inspect(this.lineNumber)+" )"}function d(a){for(var b=0,c=-1;-1!==(c=a.indexOf("\n",c+1));)b++;return b}function e(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function f(a){if("string"==typeof a)return e(a);var b=a.shift(),c={},d=[];for(!a.length||"object"!=typeof a[0]||a[0]instanceof Array||(c=a.shift());a.length;)d.push(f(a.shift()));var g="";for(var h in c)g+=" "+h+'="'+e(c[h])+'"';return"img"===b||"br"===b||"hr"===b?"<"+b+g+"/>":"<"+b+g+">"+d.join("")+"</"+b+">"}function g(a,b,c){var d;c=c||{};var e=a.slice(0);"function"==typeof c.preprocessTreeNode&&(e=c.preprocessTreeNode(e,b));var f=o(e);if(f){e[1]={};for(d in f)e[1][d]=f[d];f=e[1]}if("string"==typeof e)return e;switch(e[0]){case"header":e[0]="h"+e[1].level,delete e[1].level;break;case"bulletlist":e[0]="ul";break;case"numberlist":e[0]="ol";break;case"listitem":e[0]="li";break;case"para":e[0]="p";break;case"markdown":e[0]="html",f&&delete f.references;break;case"code_block":e[0]="pre",d=f?2:1;var h=["code"];h.push.apply(h,e.splice(d,e.length-d)),e[d]=h;break;case"inlinecode":e[0]="code";break;case"img":e[1].src=e[1].href,delete e[1].href;break;case"linebreak":e[0]="br";break;case"link":e[0]="a";break;case"link_ref":e[0]="a";var i=b[f.ref];if(!i)return f.original;delete f.ref,f.href=i.href,i.title&&(f.title=i.title),delete f.original;break;case"img_ref":e[0]="img";var i=b[f.ref];if(!i)return f.original;delete f.ref,f.src=i.href,i.title&&(f.title=i.title),delete f.original}if(d=1,f){for(var j in e[1]){d=2;break}1===d&&e.splice(d,1)}for(;d<e.length;++d)e[d]=g(e[d],b,c);return e}function h(a){for(var b=o(a)?2:1;b<a.length;)"string"==typeof a[b]?b+1<a.length&&"string"==typeof a[b+1]?a[b]+=a.splice(b+1,1)[0]:++b:(h(a[b]),++b)}function i(a,b){function c(a){this.len_after=a,this.name="close_"+b}var d=a+"_state",e="strong"===a?"em_state":"strong_state";return function(f){if(this[d][0]===b)return this[d].shift(),[f.length,new c(f.length-b.length)];var g=this[e].slice(),h=this[d].slice();this[d].unshift(b);var i=this.processInline(f.substr(b.length)),j=i[i.length-1];if(this[d].shift(),j instanceof c){i.pop();return[f.length-j.len_after,[a].concat(i)]}return this[e]=g,this[d]=h,[b.length,b]}}function j(a){for(var b=a.split(""),c=[""],d=!1;b.length;){var e=b.shift();switch(e){case" ":d?c[c.length-1]+=e:c.push("");break;case"'":case'"':d=!d;break;case"\\":e=b.shift();default:c[c.length-1]+=e}}return c}var k={};k.mk_block=function(a,d,e){1===arguments.length&&(d="\n\n");var f=new String(a);return f.trailing=d,f.inspect=c,f.toSource=b,void 0!==e&&(f.lineNumber=e),f};var l=k.isArray=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)};k.forEach=Array.prototype.forEach?function(a,b,c){return a.forEach(b,c)}:function(a,b,c){for(var d=0;d<a.length;d++)b.call(c||a,a[d],d,a)},k.isEmpty=function(a){for(var b in a)if(hasOwnProperty.call(a,b))return!1;return!0},k.extract_attr=function(a){return l(a)&&a.length>1&&"object"==typeof a[1]&&!l(a[1])?a[1]:void 0};var m=function(a){switch(typeof a){case"undefined":this.dialect=m.dialects.Gruber;break;case"object":this.dialect=a;break;default:if(!(a in m.dialects))throw new Error("Unknown Markdown dialect '"+String(a)+"'");this.dialect=m.dialects[a]}this.em_state=[],this.strong_state=[],this.debug_indent=""};m.dialects={};var n=m.mk_block=k.mk_block,l=k.isArray;m.parse=function(a,b){return new m(b).toTree(a)},m.prototype.split_blocks=function(a){a=a.replace(/(\r\n|\n|\r)/g,"\n");var b,c=/([\s\S]+?)($|\n#|\n(?:\s*\n|$)+)/g,e=[],f=1;for(null!==(b=/^(\s*\n)/.exec(a))&&(f+=d(b[0]),c.lastIndex=b[0].length);null!==(b=c.exec(a));)"\n#"===b[2]&&(b[2]="\n",c.lastIndex--),e.push(n(b[1],b[2],f)),f+=d(b[0]);return e},m.prototype.processBlock=function(a,b){var c=this.dialect.block,d=c.__order__;if("__call__"in c)return c.__call__.call(this,a,b);for(var e=0;e<d.length;e++){var f=c[d[e]].call(this,a,b);if(f)return(!l(f)||f.length>0&&!l(f[0]))&&this.debug(d[e],"didn't return a proper array"),f}return[]},m.prototype.processInline=function(a){return this.dialect.inline.__call__.call(this,String(a))},m.prototype.toTree=function(a,b){var c=a instanceof Array?a:this.split_blocks(a),d=this.tree;try{for(this.tree=b||this.tree||["markdown"];c.length;){var e=this.processBlock(c.shift(),c);e.length&&this.tree.push.apply(this.tree,e)}return this.tree}finally{b&&(this.tree=d)}},m.prototype.debug=function(){var a=Array.prototype.slice.call(arguments);a.unshift(this.debug_indent),"undefined"!=typeof print&&print.apply(print,a),"undefined"!=typeof console&&void 0!==console.log&&console.log.apply(null,a)},m.prototype.loop_re_over_block=function(a,b,c){for(var d,e=b.valueOf();e.length&&null!==(d=a.exec(e));)e=e.substr(d[0].length),c.call(this,d);return e},m.buildBlockOrder=function(a){var b=[];for(var c in a)"__order__"!==c&&"__call__"!==c&&b.push(c);a.__order__=b},m.buildInlinePatterns=function(a){var b=[];for(var c in a)if(!c.match(/^__.*__$/)){var d=c.replace(/([\\.*+?|()\[\]{}])/g,"\\$1").replace(/\n/,"\\n");b.push(1===c.length?d:"(?:"+d+")")}b=b.join("|"),a.__patterns__=b;var e=a.__call__;a.__call__=function(a,c){return void 0!==c?e.call(this,a,c):e.call(this,a,b)}};var o=k.extract_attr;m.renderJsonML=function(a,b){b=b||{},b.root=b.root||!1;var c=[];if(b.root)c.push(f(a));else for(a.shift(),!a.length||"object"!=typeof a[0]||a[0]instanceof Array||a.shift();a.length;)c.push(f(a.shift()));return c.join("\n\n")},m.toHTMLTree=function(a,b,c){"string"==typeof a&&(a=this.parse(a,b));var d=o(a),e={};d&&d.references&&(e=d.references);var f=g(a,e,c);return h(f),f},m.toHTML=function(a,b,c){var d=this.toHTMLTree(a,b,c);return this.renderJsonML(d)};var p={};p.inline_until_char=function(a,b){for(var c=0,d=[];;){if(a.charAt(c)===b)return c++,[c,d];if(c>=a.length)return null;var e=this.dialect.inline.__oneElement__.call(this,a.substr(c));c+=e[0],d.push.apply(d,e.slice(1))}},p.subclassDialect=function(a){function b(){}function c(){}return b.prototype=a.block,c.prototype=a.inline,{block:new b,inline:new c}};var q=k.forEach,o=k.extract_attr,n=k.mk_block,r=k.isEmpty,s=p.inline_until_char,t={block:{atxHeader:function(a,b){var c=a.match(/^(#{1,6})\s*(.*?)\s*#*\s*(?:\n|$)/);if(c){var d=["header",{level:c[1].length}];return Array.prototype.push.apply(d,this.processInline(c[2])),c[0].length<a.length&&b.unshift(n(a.substr(c[0].length),a.trailing,a.lineNumber+2)),[d]}},setextHeader:function(a,b){var c=a.match(/^(.*)\n([-=])\2\2+(?:\n|$)/);if(c){var d="="===c[2]?1:2,e=["header",{level:d},c[1]];return c[0].length<a.length&&b.unshift(n(a.substr(c[0].length),a.trailing,a.lineNumber+2)),[e]}},code:function(a,b){var c=[],d=/^(?: {0,3}\t| {4})(.*)\n?/;if(a.match(d)){a:for(;;){var e=this.loop_re_over_block(d,a.valueOf(),function(a){c.push(a[1])});if(e.length){b.unshift(n(e,a.trailing));break a}if(!b.length)break a;if(!b[0].match(d))break a;c.push(a.trailing.replace(/[^\n]/g,"").substring(2)),a=b.shift()}return[["code_block",c.join("\n")]]}},horizRule:function(a,b){var c=a.match(/^(?:([\s\S]*?)\n)?[ \t]*([-_*])(?:[ \t]*\2){2,}[ \t]*(?:\n([\s\S]*))?$/);if(c){var d=[["hr"]];if(c[1]){var e=n(c[1],"",a.lineNumber);d.unshift.apply(d,this.toTree(e,[]))}return c[3]&&b.unshift(n(c[3],a.trailing,a.lineNumber+1)),d}},lists:function(){function a(a){return new RegExp("(?:^("+i+"{0,"+a+"} {0,3})("+f+")\\s+)|(^"+i+"{0,"+(a-1)+"}[ ]{0,4})")}function b(a){return a.replace(/ {0,3}\t/g,"    ")}function c(a,b,c,d){if(b)return void a.push(["para"].concat(c));var e=a[a.length-1]instanceof Array&&"para"===a[a.length-1][0]?a[a.length-1]:a;d&&a.length>1&&c.unshift(d);for(var f=0;f<c.length;f++){var g=c[f];"string"==typeof g&&e.length>1&&"string"==typeof e[e.length-1]?e[e.length-1]+=g:e.push(g)}}function d(a,b){for(var c=new RegExp("^("+i+"{"+a+"}.*?\\n?)*$"),d=new RegExp("^"+i+"{"+a+"}","gm"),e=[];b.length>0&&c.exec(b[0]);){var f=b.shift(),g=f.replace(d,"");e.push(n(g,f.trailing,f.lineNumber))}return e}function e(a,b,c){var d=a.list,e=d[d.length-1];if(!(e[1]instanceof Array&&"para"===e[1][0]))if(b+1===c.length)e.push(["para"].concat(e.splice(1,e.length-1)));else{var f=e.pop();e.push(["para"].concat(e.splice(1,e.length-1)),f)}}var f="[*+-]|\\d+\\.",g=/[*+-]/,h=new RegExp("^( {0,3})("+f+")[ \t]+"),i="(?: {0,3}\\t| {4})";return function(f,i){function j(a){var b=g.exec(a[2])?["bulletlist"]:["numberlist"];return n.push({list:b,indent:a[1]}),b}var k=f.match(h);if(k){for(var l,m,n=[],o=j(k),p=!1,r=[n[0].list];;){for(var s=f.split(/(?=\n)/),t="",u="",v=0;v<s.length;v++){u="";var w=s[v].replace(/^\n/,function(a){return u=a,""}),x=a(n.length);if(k=w.match(x),void 0!==k[1]){t.length&&(c(l,p,this.processInline(t),u),p=!1,t=""),k[1]=b(k[1]);var y=Math.floor(k[1].length/4)+1;if(y>n.length)o=j(k),l.push(o),l=o[1]=["listitem"];else{var z=!1;for(m=0;m<n.length;m++)if(n[m].indent===k[1]){o=n[m].list,n.splice(m+1,n.length-(m+1)),z=!0;break}z||(y++,y<=n.length?(n.splice(y,n.length-y),o=n[y-1].list):(o=j(k),l.push(o))),l=["listitem"],o.push(l)}u=""}w.length>k[0].length&&(t+=u+w.substr(k[0].length))}t.length&&(c(l,p,this.processInline(t),u),p=!1,t="");var A=d(n.length,i);A.length>0&&(q(n,e,this),l.push.apply(l,this.toTree(A,[])));var B=i[0]&&i[0].valueOf()||"";if(!B.match(h)&&!B.match(/^ /))break;f=i.shift();var C=this.dialect.block.horizRule(f,i);if(C){r.push.apply(r,C);break}q(n,e,this),p=!0}return r}}}(),blockquote:function(a,b){if(a.match(/^>/m)){var c=[];if(">"!==a[0]){for(var d=a.split(/\n/),e=[],f=a.lineNumber;d.length&&">"!==d[0][0];)e.push(d.shift()),f++;var g=n(e.join("\n"),"\n",a.lineNumber);c.push.apply(c,this.processBlock(g,[])),a=n(d.join("\n"),a.trailing,f)}for(;b.length&&">"===b[0][0];){var h=b.shift();a=n(a+a.trailing+h,h.trailing,a.lineNumber)}var i=a.replace(/^> ?/gm,""),j=(this.tree,this.toTree(i,["blockquote"])),k=o(j);return k&&k.references&&(delete k.references,r(k)&&j.splice(1,1)),c.push(j),c}},referenceDefn:function(a,b){var c=/^\s*\[(.*?)\]:\s*(\S+)(?:\s+(?:(['"])(.*?)\3|\((.*?)\)))?\n?/;if(a.match(c)){o(this.tree)||this.tree.splice(1,0,{});var d=o(this.tree);void 0===d.references&&(d.references={});var e=this.loop_re_over_block(c,a,function(a){a[2]&&"<"===a[2][0]&&">"===a[2][a[2].length-1]&&(a[2]=a[2].substring(1,a[2].length-1));var b=d.references[a[1].toLowerCase()]={href:a[2]};void 0!==a[4]?b.title=a[4]:void 0!==a[5]&&(b.title=a[5])});return e.length&&b.unshift(n(e,a.trailing)),[]}},para:function(a){return[["para"].concat(this.processInline(a))]}},inline:{__oneElement__:function(a,b,c){var d,e;if(b=b||this.dialect.inline.__patterns__,!(d=new RegExp("([\\s\\S]*?)("+(b.source||b)+")").exec(a)))return[a.length,a];if(d[1])return[d[1].length,d[1]];var e;return d[2]in this.dialect.inline&&(e=this.dialect.inline[d[2]].call(this,a.substr(d.index),d,c||[])),e=e||[d[2].length,d[2]]},__call__:function(a,b){function c(a){"string"==typeof a&&"string"==typeof e[e.length-1]?e[e.length-1]+=a:e.push(a)}for(var d,e=[];a.length>0;)d=this.dialect.inline.__oneElement__.call(this,a,b,e),a=a.substr(d.shift()),q(d,c);return e},"]":function(){},"}":function(){},__escape__:/^\\[\\`\*_{}\[\]()#\+.!\-]/,"\\":function(a){return this.dialect.inline.__escape__.exec(a)?[2,a.charAt(1)]:[1,"\\"]},"![":function(a){var b=a.match(/^!\[(.*?)\][ \t]*\([ \t]*([^")]*?)(?:[ \t]+(["'])(.*?)\3)?[ \t]*\)/);if(b){b[2]&&"<"===b[2][0]&&">"===b[2][b[2].length-1]&&(b[2]=b[2].substring(1,b[2].length-1)),b[2]=this.dialect.inline.__call__.call(this,b[2],/\\/)[0];var c={alt:b[1],href:b[2]||""};return void 0!==b[4]&&(c.title=b[4]),[b[0].length,["img",c]]}return b=a.match(/^!\[(.*?)\][ \t]*\[(.*?)\]/),b?[b[0].length,["img_ref",{alt:b[1],ref:b[2].toLowerCase(),original:b[0]}]]:[2,"!["]},"[":function(a){var b=String(a),c=s.call(this,a.substr(1),"]");if(!c)return[1,"["];var d,e,f=1+c[0],g=c[1];a=a.substr(f);var h=a.match(/^\s*\([ \t]*([^"']*)(?:[ \t]+(["'])(.*?)\2)?[ \t]*\)/);if(h){var i=h[1];if(f+=h[0].length,i&&"<"===i[0]&&">"===i[i.length-1]&&(i=i.substring(1,i.length-1)),!h[3])for(var j=1,k=0;k<i.length;k++)switch(i[k]){case"(":j++;break;case")":0==--j&&(f-=i.length-k,i=i.substring(0,k))}return i=this.dialect.inline.__call__.call(this,i,/\\/)[0],e={href:i||""},void 0!==h[3]&&(e.title=h[3]),d=["link",e].concat(g),[f,d]}return h=a.match(/^\s*\[(.*?)\]/),h?(f+=h[0].length,e={ref:(h[1]||String(g)).toLowerCase(),original:b.substr(0,f)},d=["link_ref",e].concat(g),[f,d]):1===g.length&&"string"==typeof g[0]?(e={ref:g[0].toLowerCase(),original:b.substr(0,f)},d=["link_ref",e,g[0]],[f,d]):[1,"["]},"<":function(a){var b;return null!==(b=a.match(/^<(?:((https?|ftp|mailto):[^>]+)|(.*?@.*?\.[a-zA-Z]+))>/))?b[3]?[b[0].length,["link",{href:"mailto:"+b[3]},b[3]]]:"mailto"===b[2]?[b[0].length,["link",{href:b[1]},b[1].substr("mailto:".length)]]:[b[0].length,["link",{href:b[1]},b[1]]]:[1,"<"]},"`":function(a){var b=a.match(/(`+)(([\s\S]*?)\1)/);return b&&b[2]?[b[1].length+b[2].length,["inlinecode",b[3]]]:[1,"`"]},"  \n":function(){return[3,["linebreak"]]}}};t.inline["**"]=i("strong","**"),t.inline.__=i("strong","__"),t.inline["*"]=i("em","*"),t.inline._=i("em","_"),m.dialects.Gruber=t,m.buildBlockOrder(m.dialects.Gruber.block),m.buildInlinePatterns(m.dialects.Gruber.inline);var u=p.subclassDialect(t),o=k.extract_attr,q=k.forEach;u.processMetaHash=function(a){for(var b=j(a),c={},d=0;d<b.length;++d)if(/^#/.test(b[d]))c.id=b[d].substring(1);else if(/^\./.test(b[d]))c.class=c.class?c.class+b[d].replace(/./," "):b[d].substring(1);else if(/\=/.test(b[d])){var e=b[d].split(/\=/);c[e[0]]=e[1]}return c},u.block.document_meta=function(a){if(!(a.lineNumber>1)&&a.match(/^(?:\w+:.*\n)*\w+:.*$/)){o(this.tree)||this.tree.splice(1,0,{});var b=a.split(/\n/);for(var c in b){var d=b[c].match(/(\w+):\s*(.*)$/),e=d[1].toLowerCase(),f=d[2];this.tree[1][e]=f}return[]}},u.block.block_meta=function(a){var b=a.match(/(^|\n) {0,3}\{:\s*((?:\\\}|[^\}])*)\s*\}$/);if(b){var c,d=this.dialect.processMetaHash(b[2]);if(""===b[1]){var e=this.tree[this.tree.length-1];if(c=o(e),"string"==typeof e)return;c||(c={},e.splice(1,0,c));for(var f in d)c[f]=d[f];return[]}var g=a.replace(/\n.*$/,""),h=this.processBlock(g,[]);(c=o(h[0]))||(c={},h[0].splice(1,0,c));for(var f in d)c[f]=d[f];return h}},u.block.definition_list=function(a,b){var c,d,e=/^((?:[^\s:].*\n)+):\s+([\s\S]+)$/,f=["dl"];if(d=a.match(e)){for(var g=[a];b.length&&e.exec(b[0]);)g.push(b.shift());for(var h=0;h<g.length;++h){var d=g[h].match(e),i=d[1].replace(/\n$/,"").split(/\n/),j=d[2].split(/\n:\s+/);for(c=0;c<i.length;++c)f.push(["dt",i[c]]);for(c=0;c<j.length;++c)f.push(["dd"].concat(this.processInline(j[c].replace(/(\n)\s+/,"$1"))))}return[f]}},u.block.table=function(a){var b,c,d=function(a,b){b=b||"\\s",b.match(/^[\\|\[\]{}?*.+^$]$/)&&(b="\\"+b);for(var c,d=[],e=new RegExp("^((?:\\\\.|[^\\\\"+b+"])*)"+b+"(.*)");c=a.match(e);)d.push(c[1]),a=c[2];return d.push(a),d};if(c=a.match(/^ {0,3}\|(.+)\n {0,3}\|\s*([\-:]+[\-| :]*)\n((?:\s*\|.*(?:\n|$))*)(?=\n|$)/))c[3]=c[3].replace(/^\s*\|/gm,"");else if(!(c=a.match(/^ {0,3}(\S(?:\\.|[^\\|])*\|.*)\n {0,3}([\-:]+\s*\|[\-| :]*)\n((?:(?:\\.|[^\\|])*\|.*(?:\n|$))*)(?=\n|$)/)))return;var e=["table",["thead",["tr"]],["tbody"]];c[2]=c[2].replace(/\|\s*$/,"").split("|");var f=[];for(q(c[2],function(a){a.match(/^\s*-+:\s*$/)?f.push({align:"right"}):a.match(/^\s*:-+\s*$/)?f.push({align:"left"}):a.match(/^\s*:-+:\s*$/)?f.push({align:"center"}):f.push({})}),c[1]=d(c[1].replace(/\|\s*$/,""),"|"),b=0;b<c[1].length;b++)e[1][1].push(["th",f[b]||{}].concat(this.processInline(c[1][b].trim())));return q(c[3].replace(/\|\s*$/gm,"").split("\n"),function(a){var c=["tr"];for(a=d(a,"|"),b=0;b<a.length;b++)c.push(["td",f[b]||{}].concat(this.processInline(a[b].trim())));e[2].push(c)},this),[e]},u.inline["{:"]=function(a,b,c){if(!c.length)return[2,"{:"];var d=c[c.length-1];if("string"==typeof d)return[2,"{:"];var e=a.match(/^\{:\s*((?:\\\}|[^\}])*)\s*\}/);if(!e)return[2,"{:"];var f=this.dialect.processMetaHash(e[1]),g=o(d);g||(g={},d.splice(1,0,g));for(var h in f)g[h]=f[h];return[e[0].length,""]},m.dialects.Maruku=u,m.dialects.Maruku.inline.__escape__=/^\\[\\`\*_{}\[\]()#\+.!\-|:]/,m.buildBlockOrder(m.dialects.Maruku.block),m.buildInlinePatterns(m.dialects.Maruku.inline),a.Markdown=m,a.parse=m.parse,a.toHTML=m.toHTML,a.toHTMLTree=m.toHTMLTree,a.renderJsonML=m.renderJsonML}(function(){return window.markdown={},window.markdown}());var Monsters=function(){var a=!1,b=[{name:"Rat",killed:0},{name:"Bat",killed:0},{name:"Slime",killed:0},{name:"Kobold",killed:0},{name:"Wolf",killed:0},{name:"Lizard",killed:0},{name:"Goblin",killed:0},{name:"Bandit",killed:0},{name:"Spider",killed:0},{name:"Eagle",killed:0},{name:"Bear",killed:0},{name:"Snake",killed:0},{name:"Troll",killed:0},{name:"Kobold Warrior",killed:0},{name:"Giant Wolf",killed:0},{name:"Ghoul",killed:0},{name:"Alligator",killed:0},{name:"Giant Lizard",killed:0},{name:"Giant Rat",killed:0},{name:"Orc Child",killed:0},{name:"Stone Golem",killed:0},{name:"Lesser Elemental",killed:0},{name:"Kobold Chieftain",killed:0},{name:"Weakened Minotaur",killed:0},{name:"Troll Warrior",killed:0},{name:"Wisp",killed:0},{name:"Dragon Hatchling",killed:0},{name:"Goblin Shaman",killed:0},{name:"Giant Snake",killed:0},{name:"Mummy",killed:0},{name:"Elemental",killed:0},{name:"Lesser Imp",killed:0},{name:"Lizardman",killed:0},{name:"Orc",killed:0},{name:"Troll Chieftain",killed:0},{name:"Cyclops",killed:0},{name:"Young Vampire",killed:0},{name:"Harpy",killed:0},{name:"Empowered Wisp",killed:0},{name:"Ancient Mummy",killed:0},{name:"Imp",killed:0},{name:"Orc Soldier",killed:0},{name:"Young Minotaur",killed:0},{name:"Floating Eye",killed:0},{name:"Banshee",killed:0},{name:"Young Dragon",killed:0},{name:"Cyclops Warrior",killed:0},{name:"Lizardman Archer",killed:0},{name:"Living Armor",killed:0},{name:"Frenzied Goblin",killed:0}],c=[{name:"The First Guardian, Alstroemeria",currentHealth:91204,maximumHealth:91204,strength:151,dexterity:151,constitution:151,status:0},{name:"The Second Guardian, Bouvardia",currentHealth:372100,maximumHealth:372100,strength:305,dexterity:305,constitution:305,status:0},{name:"The Third Guardian, Clarkia",currentHealth:864900,maximumHealth:864900,strength:465,dexterity:465,constitution:465,status:0},{name:"The Fourth Guardian, Dianthus",currentHealth:1638400,maximumHealth:1638400,strength:640,dexterity:640,constitution:640,status:0},{name:"The Fifth Guardian, Erigeron",currentHealth:2930944,maximumHealth:2930944,strength:856,dexterity:856,constitution:856,status:0}],d={name:"",currentHealth:0,maximumHealth:0,strength:0,dexterity:0,constitution:0,status:0},e=this;e.save=function(){var c={savedMonsterList:b,savedInstancedMonster:d,savedInBossBattle:a};localStorage.setItem("monstersSave",JSON.stringify(c))},e.load=function(){var b=JSON.parse(localStorage.getItem("monstersSave"));b&&(void 0!==b.savedMonsterList&&f(b.savedMonsterList),void 0!==b.savedInstancedMonster&&g(b.savedInstancedMonster),void 0!==b.savedInBossBattle&&(a=b.savedInBossBattle))};var f=function(a){for(var c=0;c<a.length&&c!=b.length;c++)void 0!==a[c].killed&&(b[c].killed=a[c].killed)},g=function(a){void 0!==a.name&&(d.name=a.name),void 0!==a.currentHealth&&(d.currentHealth=a.currentHealth),void 0!==a.maximumHealth&&(d.maximumHealth=a.maximumHealth),void 0!==a.strength&&(d.strength=a.strength),void 0!==a.dexterity&&(d.dexterity=a.dexterity),void 0!==a.constitution&&(d.constitution=a.constitution),void 0!==a.status&&(d.status=a.status)};e.getMonsterList=function(){return b},e.getInstancedMonster=function(){return d},e.getBossMonster=function(a){return c[a]},e.getInBossBattle=function(){return a},e.setInstancedMonster=function(a){d=a},e.setInBossBattle=function(b){a=b},e.attackMelee=function(){player.getInBattle()&&e.battle(d,!1)},e.loadMonsterInfo=function(b){void 0!==b?(document.getElementById("monstername").innerHTML=b.name,document.getElementById("monsterhp").innerHTML=Math.round(b.currentHealth),document.getElementById("monsterstr").innerHTML=b.strength,document.getElementById("monsterdex").innerHTML=b.dexterity,document.getElementById("monstercon").innerHTML=b.constitution,document.getElementById("monsterbar").style.width=b.currentHealth/b.maximumHealth*100+"%",document.getElementById("combatlog").innerHTML=a?"You challenge a floor boss! You begin fighting "+b.name+"!<br>":"You are attacked by a "+b.name+"!<br>",player.setInBattle(!0)):(document.getElementById("monstername").innerHTML="None",document.getElementById("monsterhp").innerHTML="0",document.getElementById("monsterstr").innerHTML="0",document.getElementById("monsterdex").innerHTML="0",document.getElementById("monstercon").innerHTML="0",document.getElementById("monsterbar").style.width="0%")},e.battle=function(a,b){if(player.getInBattle()){var c=!1;if(!b)if(document.getElementById("combatlog").innerHTML="",buffs.getCastCureInBattle()&&player.getHealthCurrentValue()<=player.getHealthMaximumValue()/2){if(spells.castSpell("cure"))return buffs.updateTemporaryBuffs(!0),!0;c=h(a)}else c=h(a);c||(c=m(a))}else player.setInBattle(!0),player.loadRestButton(),player.loadExploreButton(),e.loadMonsterInfo(a),buffs.getCastFireballInBattle()&&spells.castSpell("fireball");buffs.updateTemporaryBuffs(!0)};var h=function(a){var b=l(player.getStrengthLevel()+player.getStrengthBonus(),player.getDexterityLevel()+player.getDexterityBonus(),a.constitution,a.currentHealth);return 0!==buffs.getRageTimeLeft()&&(b*=5),b>=a.currentHealth&&(b=a.currentHealth),document.getElementById("combatlog").innerHTML+="You dealt "+Math.round(b)+" damage to the "+a.name+".<br>",player.gainExperience(a,!0),e.monsterTakeDamage(a,b)};e.monsterTakeDamage=function(a,b){return a.currentHealth-=b,document.getElementById("monsterhp").innerHTML=Math.floor(a.currentHealth),document.getElementById("monsterbar").style.width=a.currentHealth/a.maximumHealth*100+"%",a.currentHealth<=0&&(i(a),!0)};var i=function(b){player.setInBattle(!1),a?(document.getElementById("combatlog").innerHTML+="You have defeated a floor boss! "+b.name+" recognizes your strength and allows you to advance.",tower.setBossFound(!1),tower.setLastBossDefeated(player.getCurrentFloor()),tower.bossDefeated(),a=!1):(document.getElementById("combatlog").innerHTML+="You have defeated the "+b.name+"!<br>",Math.floor(100*Math.random())<10&&(j(b),inventory.updateInventory()),k(b.name)),upgrades.gainExcelia(b),player.loadRestButton(),player.loadExploreButton(),e.loadMonsterInfo()},j=function(a){var b=Math.floor(5*Math.random()),c=a.strength+a.dexterity+a.constitution;0===b?inventory.createCrystal("Strength",c):1==b?inventory.createCrystal("Dexterity",c):2==b?inventory.createCrystal("Constitution",c):3==b?inventory.createCrystal("Speed",c):4==b&&inventory.createCrystal("Magic",c),document.getElementById("combatlog").innerHTML+="The "+a.name+" has left an experience crystal behind!<br>"},k=function(a){for(var c=0;c<b.length;c++)b[c].name==a&&b[c].killed++},l=function(a,b,c,d){var e=.1*b*(2*a-.5*c);return e<0?e=0:e>d&&(e=d),e},m=function(a){var b=l(a.strength,a.dexterity,player.getConstitutionLevel()+player.getConstitutionBonus(),player.getHealthCurrentValue());if(0!==buffs.getRageTimeLeft()&&(b*=2),0===buffs.getAegisTimeLeft()){var c=buffs.getBarrierLeft();if(c>0){if(c>=b)return buffs.setBarrierLeft(c-b),document.getElementById("combatlog").innerHTML+="Your barrier absorbed "+Math.round(b)+" damage from "+a.name+"'s attack.<br>",buffs.updateTemporaryBuffs(!1),!1;document.getElementById("combatlog").innerHTML+="Your barrier absorbed "+Math.round(c)+" damage from "+a.name+"'s attack.<br>",document.getElementById("combatlog").innerHTML+="Your barrier has shattered.<br>",b-=c,buffs.setBarrierLeft(0),buffs.updateTemporaryBuffs(!1)}if(player.setHealthCurrentValue(player.getHealthCurrentValue()-b),document.getElementById("combatlog").innerHTML+="You took "+Math.round(b)+" damage from the "+a.name+"'s attack.<br>",0===player.getHealthCurrentValue())return player.death(a),!0}else document.getElementById("combatlog").innerHTML+="Aegis absorbed "+Math.round(b)+" damage from "+a.name+"'s attack.<br>";return player.gainExperience(a,!1),!1};e.battleChance=function(a){return a?(n(),!0):100*Math.random()<=tower.getFloorMonsterDensity(player.getCurrentFloor())&&(n(),!0)};var n=function(){for(var a=Math.floor((player.getCurrentFloor()-1)/10),b=Math.floor(10*Math.random());10==b;)b=Math.floor(10*Math.random());d=o(10*a+b),e.battle(d,!1)},o=function(a){var c={name:"",currentHealth:0,maximumHealth:0,strength:0,dexterity:0,constitution:0,status:0},d=Math.round(15*player.getCurrentFloor()+Math.pow(1.1,player.getCurrentFloor()-1)-1);return c.name=b[a].name,c.strength++,c.dexterity++,c.constitution++,d-=3,p(c,d),c.maximumHealth=q(c.constitution),c.currentHealth=c.maximumHealth,c},p=function(a,b){for(var c;0!==b;){for(c=Math.floor(3*Math.random());3==c;)c=Math.floor(3*Math.random());0===c?a.strength++:1==c?a.dexterity++:2==c&&a.constitution++,b--}},q=function(a){return 4*Math.pow(a,2)};e.runAway=function(){if(player.getInBattle()){document.getElementById("combatlog").innerHTML="";var b=Math.random()*(d.strength+d.dexterity+d.constitution);b<player.getSpeedLevel()?(document.getElementById("combatlog").innerHTML+="You escaped from the battle against "+d.name+".",e.loadMonsterInfo(),player.setSpeedExperience(player.getSpeedExperience()+b),player.setInBattle(!1),player.loadExploreButton(),player.loadRestButton()):(document.getElementById("combatlog").innerHTML+="You failed to run away.<br>",e.battle(d,!0))}a&&(a=!1)}},monsters=new Monsters,Player=function(){var a="Crawler",b={currentValue:100,maximumValue:100},c={currentValue:50,maximumValue:50},d={level:5,experience:0,nextLevel:100,bonus:0},e={level:5,experience:0,nextLevel:100,bonus:0},f={level:5,experience:0,nextLevel:100,bonus:0},g={level:5,experience:0,nextLevel:100,bonus:0},h={level:5,experience:0,nextLevel:100,bonus:0},i=0,j=!1,k=!1,l=this;l.save=function(){var k={savedName:a,savedHealth:b,savedMana:c,savedStrength:d,savedDexterity:e,savedConstitution:f,savedSpeed:g,savedMagic:h,savedCurrentFloor:i,savedInBattle:j};localStorage.setItem("playerSave",JSON.stringify(k))},l.load=function(){var b=JSON.parse(localStorage.getItem("playerSave"));b?(a=void 0!==b.savedName?b.savedName:prompt("Please, enter your name:","Crawler"),void 0!==b.savedHealth&&m(b.savedHealth),void 0!==b.savedMana&&n(b.savedMana),void 0!==b.savedStrength&&o(b.savedStrength),void 0!==b.savedDexterity&&p(b.savedDexterity),void 0!==b.savedConstitution&&q(b.savedConstitution),void 0!==b.savedSpeed&&r(b.savedSpeed),void 0!==b.savedMagic&&s(b.savedMagic),void 0!==b.savedCurrentFloor&&(i=b.savedCurrentFloor),void 0!==b.savedInBattle&&(j=b.savedInBattle)):a=prompt("Please, enter your name:","Crawler")};var m=function(a){void 0!==a.currentValue&&(b.currentValue=a.currentValue),void 0!==a.maximumValue&&(b.maximumValue=a.maximumValue)},n=function(a){void 0!==a.currentValue&&(c.currentValue=a.currentValue),void 0!==a.maximumValue&&(c.maximumValue=a.maximumValue)},o=function(a){void 0!==a.level&&(d.level=a.level),void 0!==a.experience&&(d.experience=a.experience),void 0!==a.nextLevel&&(d.nextLevel=a.nextLevel),void 0!==a.bonus&&(d.bonus=a.bonus)},p=function(a){void 0!==a.level&&(e.level=a.level),void 0!==a.experience&&(e.experience=a.experience),void 0!==a.nextLevel&&(e.nextLevel=a.nextLevel),void 0!==a.bonus&&(e.bonus=a.bonus)},q=function(a){void 0!==a.level&&(f.level=a.level),void 0!==a.experience&&(f.experience=a.experience),void 0!==a.nextLevel&&(f.nextLevel=a.nextLevel),void 0!==a.bonus&&(f.bonus=a.bonus)},r=function(a){void 0!==a.level&&(g.level=a.level),void 0!==a.experience&&(g.experience=a.experience),void 0!==a.nextLevel&&(g.nextLevel=a.nextLevel),void 0!==a.bonus&&(g.bonus=a.bonus)},s=function(a){void 0!==a.level&&(h.level=a.level),void 0!==a.experience&&(h.experience=a.experience),void 0!==a.nextLevel&&(h.nextLevel=a.nextLevel),void 0!==a.bonus&&(h.bonus=a.bonus)};l.getName=function(){return a},l.getInBattle=function(){return j},l.getResting=function(){return k},l.getCurrentFloor=function(){return i},l.getHealthCurrentValue=function(){return b.currentValue},l.getHealthMaximumValue=function(){return b.maximumValue},l.getManaCurrentValue=function(){return c.currentValue},l.getManaMaximumValue=function(){return c.maximumValue},l.getStrengthLevel=function(){return d.level},l.getDexterityLevel=function(){return e.level},l.getConstitutionLevel=function(){return f.level},l.getSpeedLevel=function(){return g.level},l.getMagicLevel=function(){return h.level},l.getStrengthExperience=function(){return d.experience},l.getDexterityExperience=function(){return e.experience},l.getConstitutionExperience=function(){return f.experience},l.getSpeedExperience=function(){return g.experience},l.getMagicExperience=function(){return h.experience},l.getStrengthBonus=function(){return d.bonus},l.getDexterityBonus=function(){return e.bonus},l.getConstitutionBonus=function(){return f.bonus},l.getSpeedBonus=function(){return g.bonus},l.getMagicBonus=function(){return h.bonus},l.setInBattle=function(a){j=a},l.setCurrentFloor=function(a){i=a},l.setHealthCurrentValue=function(a){a>b.maximumValue&&(a=b.maximumValue),b.currentValue=a,z("hp",b)},l.setHealthMaximumValue=function(a){b.maximumValue=a,z("hp",b)},l.setManaCurrentValue=function(a){a>c.maximumValue&&(a=c.maximumValue),c.currentValue=a,z("mp",c)},l.setManaMaximumValue=function(a){c.maximumValue=a,z("mp",c)},l.setStrengthExperience=function(a){for(d.experience=a;d.experience>=d.nextLevel;)d.experience-=d.nextLevel,t(d.level+1);y("str",d)},l.setDexterityExperience=function(a){for(e.experience=a;e.experience>=e.nextLevel;)e.experience-=e.nextLevel,u(e.level+1);y("dex",e)},l.setConstitutionExperience=function(a){for(f.experience=a;f.experience>=f.nextLevel;)f.experience-=f.nextLevel,v(f.level+1);y("con",f)},l.setSpeedExperience=function(a){for(g.experience=a;g.experience>=g.nextLevel;)g.experience-=g.nextLevel,w(g.level+1);y("spd",g)},l.setMagicExperience=function(a){for(h.experience=a;h.experience>=h.nextLevel;)h.experience-=h.nextLevel,x(h.level+1);y("mgc",h)};var t=function(a){d.level=a,d.nextLevel=A(d.level+1),y("str",d)},u=function(a){e.level=a,e.nextLevel=A(e.level+1),y("dex",e)},v=function(a){f.level=a,f.nextLevel=A(f.level+1),
l.setHealthMaximumValue(4*Math.pow(f.level+f.bonus,2)),y("con",f)},w=function(a){g.level=a,g.nextLevel=A(g.level+1),y("spd",g)},x=function(a){h.level=a,h.nextLevel=A(h.level+1),spells.updateSpellbook(),l.setManaMaximumValue(2*Math.pow(h.level+h.bonus,2)),y("mgc",h)};l.setStrengthBonus=function(a){d.bonus=a,y("str",d)},l.setDexterityBonus=function(a){e.bonus=a,y("dex",e)},l.setConstitutionBonus=function(a){f.bonus=a,l.setHealthMaximumValue(4*Math.pow(f.level+f.bonus,2)),y("con",f)},l.setSpeedBonus=function(a){g.bonus=a,y("spd",g)},l.setMagicBonus=function(a){h.bonus=a,l.setManaMaximumValue(2*Math.pow(h.level+h.bonus,2)),y("mgc",h)},l.loadPlayerScreen=function(){document.getElementById("name").innerHTML=a,y("str",d),y("dex",e),y("con",f),y("spd",g),y("mgc",h),z("hp",b),z("mp",c)};var y=function(a,b){document.getElementById(a).innerHTML=Math.round(100*(b.level+b.bonus))/100,document.getElementById(a+"per").innerHTML=Math.round(b.experience/b.nextLevel*100*100)/100+"%",document.getElementById(a+"prog").style.width=b.experience/b.nextLevel*100+"%"},z=function(a,b){document.getElementById(a).innerHTML=Math.round(b.currentValue),document.getElementById(a+"max").innerHTML=Math.round(b.maximumValue),document.getElementById(a+"bar").style.width=b.currentValue/b.maximumValue*100+"%"},A=function(a){return 3*(Math.pow(a,2)+a)};l.rest=function(){k&&(l.setHealthCurrentValue(b.currentValue+5*f.level*buffs.getRestingMultiplier()),l.setManaCurrentValue(c.currentValue+5*h.level*buffs.getRestingMultiplier()),l.isFullyRested()&&l.toggleRest())},l.isFullyRested=function(){return b.currentValue==b.maximumValue&&c.currentValue==c.maximumValue},l.loadExploreButton=function(){0!==i?j||k?tower.floorExplorationComplete(i)?document.getElementById("exploreButton").innerHTML='<button class="btn btn-danger btn-block" disabled="disabled">Find Monster</button>':document.getElementById("exploreButton").innerHTML='<button class="btn btn-danger btn-block" disabled="disabled">Explore</button>':tower.floorExplorationComplete(i)?document.getElementById("exploreButton").innerHTML='<button class="btn btn-default btn-block" onClick="tower.exploreFloor()">Find Monster</button>':document.getElementById("exploreButton").innerHTML='<button class="btn btn-default btn-block" onClick="tower.exploreFloor()">Explore</button>':document.getElementById("exploreButton").innerHTML=""},l.loadRestButton=function(){document.getElementById("restButton").innerHTML=0!==i?j?'<button class="btn btn-danger btn-block" disabled="disabled">Rest</button>':k?'<button class="btn btn-success btn-block" onClick="player.toggleRest()">Stop Resting</button>':'<button class="btn btn-default btn-block" onClick="player.toggleRest()">Rest</button>':""},l.gainExperience=function(a,b){var c=buffs.getLevelingSpeedMultiplier();b?(l.setStrengthExperience(d.experience+c*(a.strength/f.level)),l.setDexterityExperience(e.experience+c*(a.dexterity/e.level))):l.setConstitutionExperience(f.experience+c*(a.strength/f.level))},l.death=function(a){j=!1,monsters.getInBossBattle()&&monsters.setInBossBattle(!1),document.getElementById("combatlog").innerHTML+="You have been defeated by the "+a.name+"!",system.getIdleMode()&&system.toggleIdle(),tower.changeFloor(-i),upgrades.updateExcelia(-(100-buffs.getExceliaSavedOnDeath())*upgrades.getExcelia()/100),B(10-buffs.getDeathPenaltyReduction()),C(),monsters.loadMonsterInfo(),spells.updateSpellbook(),player.toggleRest()};var B=function(a){t(d.level-Math.floor(d.level*(a/100))),u(e.level-Math.floor(e.level*(a/100))),v(f.level-Math.floor(f.level*(a/100))),w(g.level-Math.floor(g.level*(a/100))),x(h.level-Math.floor(h.level*(a/100)))},C=function(){l.setStrengthExperience(0),l.setDexterityExperience(0),l.setConstitutionExperience(0),l.setSpeedExperience(0),l.setMagicExperience(0)};l.toggleRest=function(){k=!k,l.loadRestButton(),l.loadExploreButton()}},player=new Player,Spells=function(){var a=0,b=[];b.push({name:"Cure",id:"cure",type:0,requiredMagic:5,arcaniaCost:0,learned:!0,baseMana:15,experience:0,nextLevel:150,baseNextLevel:150,level:0,description:""}),b.push({name:"Fireball",id:"fireball",type:1,requiredMagic:5,arcaniaCost:0,learned:!0,baseMana:10,experience:0,nextLevel:100,baseNextLevel:100,level:0,description:""}),b.push({name:"Transmutation",id:"transmutation",type:3,requiredMagic:5,arcaniaCost:0,learned:!0,baseMana:50,experience:0,nextLevel:500,baseNextLevel:500,level:0,description:""}),b.push({name:"Barrier",id:"barrier",type:0,requiredMagic:10,arcaniaCost:1e3,learned:!1,baseMana:100,experience:0,nextLevel:1e3,baseNextLevel:1e3,level:0,description:""}),b.push({name:"Slow",id:"slow",type:2,requiredMagic:20,arcaniaCost:2e3,learned:!1,baseMana:400,experience:0,nextLevel:4e3,baseNextLevel:4e3,level:0,description:""}),b.push({name:"Rage",id:"rage",type:1,requiredMagic:25,arcaniaCost:2500,learned:!1,baseMana:1250,experience:0,nextLevel:12500,baseNextLevel:12500,level:0,description:""}),b.push({name:"Shadow Ball",id:"shadowball",type:1,requiredMagic:30,arcaniaCost:3e3,learned:!1,baseMana:150,experience:0,nextLevel:1500,baseNextLevel:1500,level:0,description:""}),b.push({name:"Aegis",id:"aegis",type:0,requiredMagic:50,arcaniaCost:5e3,learned:!1,baseMana:5e3,experience:0,nextLevel:5e4,baseNextLevel:5e4,level:0,description:""});var c=this;c.save=function(){var c={savedArcania:a,savedSpellbook:b};localStorage.setItem("spellsSave",JSON.stringify(c))},c.load=function(){var b=JSON.parse(localStorage.getItem("spellsSave"));b&&(void 0!==b.savedArcania&&(a=b.savedArcania),void 0!==b.savedSpellbook&&d(b.savedSpellbook))};var d=function(a){for(var c=!1,d=0;d<a.length&&d!=b.length;d++){for(var e=0;e<b.length;e++)if(b[e].id==a[d].id){c=!0;break}c&&(void 0!==a[d].learned&&(b[e].learned=a[d].learned),void 0!==a[d].experience&&(b[e].experience=a[d].experience),void 0!==a[d].nextLevel&&(b[e].nextLevel=a[d].nextLevel),void 0!==a[d].level&&(b[e].level=a[d].level)),c=!1}};c.setArcania=function(b){a=b,document.getElementById("arcania").innerHTML=Math.round(100*a)/100};var e=function(){for(var a=0;a<b.length;a++)"cure"==b[a].id?b[a].description="Call the powers of nature to heal yourself for "+l(b[a])+" HP":"fireball"==b[a].id?b[a].description="Ignite mana around your hand and throw it. Deals "+n(b[a])+" fire damage.":"barrier"==b[a].id?b[a].description="Condense mana around you to put up a barrier that will absorb "+p(b[a])+" damage.":"aegis"==b[a].id?b[a].description="Call for heavenly protection and take no damage for "+r(b[a])+" turns.":"slow"==b[a].id?b[a].description="Magically shackle your enemy, reducing its dexterity for "+t(b[a])+" points.":"rage"==b[a].id?b[a].description="Fill yourself with rage for "+v(b[a])+" turns. You deal 5x damage, however, you take 2x damage and cannot cast other spells.":"transmutation"==b[a].id?b[a].description="Give material form to the Arcania inside you. Transforms 100 Arcania into "+x(b[a])+" gold.":"shadowball"==b[a].id&&(b[a].description="Condense shadow energy into a sphere you can hurl into enemies. Deals "+z(b[a])+" damage.")},f=function(a){return 0===a?"btn-info":1==a?"btn-danger":2==a?"btn-warning":3==a?"btn-success":void 0},g=function(a){for(var c=0;c<b.length;c++)if(b[c].id==a)return c},h=function(a){var b,c=a.baseMana;if(2==a.type){for(b=0;b<a.level;b++)c-=.1*c;c<=10&&(c=10)}else for(b=0;b<a.level;b++)c+=.1*c;return Math.round(c)},i=function(a,b){for(a.experience+=b;a.experience>=a.nextLevel;)a.level++,a.experience-=a.nextLevel,a.nextLevel=Math.pow(2,a.level)*a.baseNextLevel,c.updateSpellbook();j(a,!0)};c.updateSpellbook=function(){document.getElementById("spellbook").innerHTML="";for(var a=0;a<=3;a++)document.getElementById("spellbook"+a).innerHTML="";for(e(),a=0;a<b.length;a++)if(player.getMagicLevel()>=b[a].requiredMagic&&!1===b[a].learned){var c=f(b[a].type);document.getElementById("spellbook").innerHTML+='<div class="row"><div class="col-xs-5"><button class="btn '+c+' btn-block" data-toggle="tooltip" data-placement="top" title="'+b[a].description+'" onClick="spells.buySpell(\''+b[a].id+"')\"> Buy "+b[a].name+'</button></div><div class="col-xs-7"><p class="text-right">Arcania Cost: <span id="'+b[a].id+'arcaniacostall">0</span></p></div></div>',document.getElementById("spellbook"+b[a].type).innerHTML+='<div class="row"><div class="col-xs-5"><button class="btn '+c+' btn-block" data-toggle="tooltip" data-placement="top" title="'+b[a].description+'" onClick="spells.buySpell(\''+b[a].id+"')\"> Buy "+b[a].name+'</button></div><div class="col-xs-7"><p class="text-right">Arcania Cost: <span id="'+b[a].id+'arcaniacost">0</span></p></div></div>',j(b[a],!1)}else if(!0===b[a].learned){var c=f(b[a].type);document.getElementById("spellbook").innerHTML+='<div class="row"><div class="col-xs-5"><button class="btn '+c+' btn-block" data-toggle="tooltip" data-placement="top" title="'+b[a].description+'" onClick="spells.castSpell(\''+b[a].id+"')\">"+b[a].name+'</button></div><div class="col-xs-7"><div class="progress"><div id="'+b[a].id+'xpall" class="progress-bar" role="progressbar" style="width: '+100*b[a].experience/b[a].nextLevel+'%;"><span id="'+b[a].id+'progall">'+100*b[a].experience/b[a].nextLevel+'%</span></div></div></div></div><div class="row"><div class="col-xs-5">Level: <span id="'+b[a].id+'levelall">0</span></div><div class="col-xs-6"><p class="text-right">Mana Cost: <span id="'+b[a].id+'costall">0</span></p></div></div>',document.getElementById("spellbook"+b[a].type).innerHTML+='<div class="row"><div class="col-xs-5"><button class="btn '+c+' btn-block" data-toggle="tooltip" data-placement="top" title="'+b[a].description+'" onClick="spells.castSpell(\''+b[a].id+"')\">"+b[a].name+'</button></div><div class="col-xs-7"><div class="progress"><div id="'+b[a].id+'xp" class="progress-bar" role="progressbar" style="width: '+100*b[a].experience/b[a].nextLevel+'%;"><span id="'+b[a].id+'prog">'+100*b[a].experience/b[a].nextLevel+'%</span></div></div></div></div><div class="row"><div class="col-xs-5">Level: <span id="'+b[a].id+'level">0</span></div><div class="col-xs-6"><p class="text-right">Mana Cost: <span id="'+b[a].id+'cost">0</span></p></div></div>',b[a].learned=!0,j(b[a],!0)}$(document).ready(function(){$('[data-toggle="tooltip"]').tooltip()})};var j=function(b,c){document.getElementById("arcania").innerHTML=Math.round(100*a)/100,c?(document.getElementById(b.id+"costall").innerHTML=h(b),document.getElementById(b.id+"cost").innerHTML=h(b),document.getElementById(b.id+"xpall").style.width=b.experience/b.nextLevel*100+"%",document.getElementById(b.id+"progall").innerHTML=Math.round(b.experience/b.nextLevel*100*100)/100+"%",document.getElementById(b.id+"levelall").innerHTML=b.level,document.getElementById(b.id+"xp").style.width=b.experience/b.nextLevel*100+"%",document.getElementById(b.id+"prog").innerHTML=Math.round(b.experience/b.nextLevel*100*100)/100+"%",document.getElementById(b.id+"level").innerHTML=b.level):(document.getElementById(b.id+"arcaniacost").innerHTML=b.arcaniaCost,document.getElementById(b.id+"arcaniacostall").innerHTML=b.arcaniaCost)};c.isSpellLearned=function(a){if(""===a)return!0;for(var c=0;c<b.length;c++)if(b[c].id==a)return b[c].learned;return!1},c.castSpell=function(d){var e=g(d),f=h(b[e]);if(player.getManaCurrentValue()>=f&&0===buffs.getRageTimeLeft()&&c.isSpellLearned(d)){var j;if("cure"==b[e].id?j=k(b[e]):"fireball"==b[e].id?j=m(b[e]):"barrier"==b[e].id?j=o(b[e]):"slow"==b[e].id?j=s(b[e]):"aegis"==b[e].id?j=q(b[e]):"rage"==b[e].id?j=u(b[e]):"transmutation"==b[e].id?j=w(b[e]):"shadowball"==b[e].id&&(j=y(b[e])),j)return"transmutation"!==b[e].id&&(a+=b[e].level+f/100),player.setManaCurrentValue(player.getManaCurrentValue()-f),i(b[e],buffs.getSpellLevelingMultiplier()*f),player.setMagicExperience(player.getMagicExperience()+buffs.getLevelingSpeedMultiplier()*(b[e].level+1+f/10)),!0}return!1},c.buySpell=function(d){var e=g(d);a>=b[e].arcaniaCost&&(c.setArcania(a-b[e].arcaniaCost),b[e].learned=!0),c.updateSpellbook()};var k=function(a){var b=player.getHealthCurrentValue(),c=player.getHealthMaximumValue();if(b==c)return!1;var d=l(a);return c-b<d&&(d=c-b),player.setHealthCurrentValue(b+d),player.getInBattle()&&(document.getElementById("combatlog").innerHTML="",document.getElementById("combatlog").innerHTML+="You healed yourself for "+Math.round(d)+" HP with Cure.<br>",monsters.battle(monsters.getInstancedMonster(),!0)),!0},l=function(a){var b=15*a.level,c=3*(player.getMagicLevel()+player.getMagicBonus()-5);return Math.floor(25+b+c)},m=function(a){if(player.getInBattle()){var b=monsters.getInstancedMonster(),c=n(a);return b.currentHealth<=c&&(c=b.currentHealth),document.getElementById("combatlog").innerHTML="",document.getElementById("combatlog").innerHTML+="Your fireball hit the "+b.name+" for "+Math.floor(c)+" damage.<br>",monsters.monsterTakeDamage(monsters.getInstancedMonster(),c)||monsters.battle(monsters.getInstancedMonster(),!0),!0}return!1},n=function(a){var b=5*a.level,c=1*(player.getMagicLevel()+player.getMagicBonus()-5);return Math.floor(15+b+c)},o=function(a){var b=p(a);return buffs.getBarrierLeft()!=b&&(buffs.setBarrierLeft(b),buffs.updateTemporaryBuffs(!1),player.getInBattle()&&(document.getElementById("combatlog").innerHTML="",document.getElementById("combatlog").innerHTML+="You created a magical barrier.<br>",monsters.battle(monsters.getInstancedMonster(),!0)),!0)},p=function(a){var b=50*a.level,c=10*(player.getMagicLevel()+player.getMagicBonus()-10);return Math.floor(50+b+c)},q=function(a){return 0===buffs.getAegisTimeLeft()&&(buffs.setAegisTimeLeft(r(a)),buffs.updateTemporaryBuffs(!1),player.getInBattle()&&(document.getElementById("combatlog").innerHTML="",document.getElementById("combatlog").innerHTML+="You summon the heavenly shield, Aegis.<br>",monsters.battle(monsters.getInstancedMonster(),!0)),!0)},r=function(a){var b=1*a.level,c=.2*(player.getMagicLevel()+player.getMagicBonus()-50);return Math.floor(5+b+c)},s=function(a){var b=monsters.getInstancedMonster();if(!player.getInBattle()||b.dexterity<=1)return!1;var c=t(a);return b.dexterity<=c&&(c=b.dexterity-1),b.dexterity-=c,document.getElementById("monsterdex").innerHTML=b.dexterity,document.getElementById("combatlog").innerHTML="",document.getElementById("combatlog").innerHTML+="You have cast slow on the "+b.name+". Its dexterity has been lowered by "+c+".<br>",monsters.setInstancedMonster(b),monsters.battle(monsters.getInstancedMonster(),!0),!0},t=function(a){var b=1*a.level,c=.2*(player.getMagicLevel()+player.getMagicBonus()-20);return Math.floor(5+b+c)},u=function(a){return!!player.getInBattle()&&(buffs.setRageTimeLeft(v(a)),buffs.updateTemporaryBuffs(!1),document.getElementById("combatlog").innerHTML="",document.getElementById("combatlog").innerHTML+="You have entered a state of frenzy!<br>",monsters.battle(monsters.getInstancedMonster(),!0),!0)},v=function(a){var b=1*a.level,c=.2*(player.getMagicLevel()+player.getMagicBonus()-25);return Math.floor(5+b+c)},w=function(b){return!(a<100||player.getInBattle())&&(c.setArcania(a-100),inventory.setGold(inventory.getGold()+x(b)),!0)},x=function(a){var b=1*a.level,c=.2*(player.getMagicLevel()+player.getMagicBonus()-5);return Math.floor(1+b+c)},y=function(a){if(player.getInBattle()){var b=monsters.getInstancedMonster(),c=z(a);return b.currentHealth<=c&&(c=b.currentHealth),document.getElementById("combatlog").innerHTML="",document.getElementById("combatlog").innerHTML+="Your shadow ball hit the "+b.name+" for "+Math.floor(c)+" damage.<br>",monsters.monsterTakeDamage(monsters.getInstancedMonster(),c)||monsters.battle(monsters.getInstancedMonster(),!0),!0}return!1},z=function(a){var b=50*a.level,c=10*(player.getMagicLevel()+player.getMagicBonus()-30);return Math.floor(300+b+c)}},spells=new Spells,System=function(){var a,b,c,d=0,e=1e3,f=!1,g=!1,h=!1,i=this,j=function(){var a={savedTicks:d,trackOptOut:h};localStorage.setItem("systemSave",JSON.stringify(a))},k=function(){j(),player.save(),spells.save(),upgrades.save(),buffs.save(),monsters.save(),tower.save(),inventory.save()};i.toggleTracking=function(){h=!h,k(),location.reload()};var l=function(a,b,c,d){if(!0!==h)return ga("send","event",a,b,c||null,d||null)},m=function(){var a=JSON.parse(localStorage.getItem("systemSave"));a&&(void 0!==a.savedTicks&&(d=a.savedTicks),void 0!==a.trackOptOut&&(h=a.trackOptOut))},n=function(){m(),player.load(),spells.load(),upgrades.load(),buffs.load(),monsters.load(),tower.load(),inventory.load(),l("system","load","speed",player.getSpeedLevel()),l("system","load","magic",player.getMagicLevel()),l("system","load","strength",player.getStrengthLevel()),l("system","load","dexterity",player.getDexterityLevel()),l("system","load","constitution",player.getConstitutionLevel()),l("system","load","tower_level",tower.getMaxFloor())};i.getIdleMode=function(){return g};var o=function(){b=new Slider("#idleRest",{ticks:[10,20,30,40,50,60,70,80,90,100],ticks_snap_bounds:10,value:100})},p=function(){c=new Slider("#idleMpRest",{ticks:[10,20,30,40,50,60,70,80,90,100],ticks_snap_bounds:10,value:100})};i.runGame=function(){a=window.setInterval(r,e)},i.gameSpeed=function(b){g&&(e=b,a=window.clearInterval(a),i.runGame(),document.getElementById("speed").innerHTML=1e3/b)},i.exportGame=function(){a=window.clearInterval(a),k();var b={systemSave:localStorage.getItem("systemSave"),playerSave:localStorage.getItem("playerSave"),spellsSave:localStorage.getItem("spellsSave"),upgradesSave:localStorage.getItem("upgradesSave"),buffsSave:localStorage.getItem("buffsSave"),monstersSave:localStorage.getItem("monstersSave"),towerSave:localStorage.getItem("towerSave"),inventorySave:localStorage.getItem("inventorySave")};document.getElementById("dataContainer").innerHTML=JSON.stringify(b),this.runGame()},i.importGame=function(){a=window.clearInterval(a);try{var b=document.getElementById("dataContainer").value,c=JSON.parse(b);confirm("Are you sure you want to import this data? Your existing save will be wiped.")&&(localStorage.clear(),localStorage.setItem("systemSave",c.systemSave),localStorage.setItem("playerSave",c.playerSave),localStorage.setItem("spellsSave",c.spellsSave),localStorage.setItem("upgradesSave",c.upgradesSave),localStorage.setItem("buffsSave",c.buffsSave),localStorage.setItem("monstersSave",c.monstersSave),localStorage.setItem("towerSave",c.towerSave),localStorage.setItem("inventorySave",c.inventorySave),n(),location.reload())}catch(a){console.warn(a),alert("Unable to parse save game data!")}this.runGame()},i.hardReset=function(){a=window.clearInterval(a),confirm("Are you sure you want to wipe all your progress?")?(localStorage.removeItem("systemSave"),localStorage.removeItem("playerSave"),localStorage.removeItem("spellsSave"),localStorage.removeItem("upgradesSave"),localStorage.removeItem("buffsSave"),localStorage.removeItem("monstersSave"),localStorage.removeItem("towerSave"),localStorage.removeItem("inventorySave"),location.reload()):this.runGame()};var q=function(a){document.getElementById("seconds").innerHTML=a%60,a=Math.floor(a/60),document.getElementById("minutes").innerHTML=a%60,a=Math.floor(a/60),document.getElementById("hours").innerHTML=a%24,a=Math.floor(a/24),document.getElementById("days").innerHTML=a},r=function(){f||s(),d++,player.getResting()&&player.rest(),g&&(player.getInBattle()?monsters.attackMelee():(0===buffs.getBarrierLeft()&&buffs.getAutoBarrierCast()&&spells.castSpell("barrier"),player.getHealthCurrentValue()/player.getHealthMaximumValue()*100>=b.getValue()&&player.getManaCurrentValue()/player.getManaMaximumValue()*100>=c.getValue()&&!player.getResting()?tower.exploreFloor():player.getResting()&&!player.isFullyRested()||player.toggleRest())),q(d),k()};i.toggleIdle=function(){if(0===player.getCurrentFloor())return!1;g?(i.gameSpeed(1e3),g=!1,t()):(g=!0,t())};var s=function(){n(),o(),p(),t(),player.loadPlayerScreen(),player.loadExploreButton(),player.loadRestButton(),spells.updateSpellbook(),upgrades.loadExcelia(),upgrades.updateUpgrades(),upgrades.loadTimeUpgrades(),buffs.updateTemporaryBuffs(!1),buffs.updateToggleableBuffs(),buffs.updatePermanentBuffs(),player.getInBattle()&&monsters.loadMonsterInfo(monsters.getInstancedMonster()),tower.loadTowerScreen(),inventory.updateInventoryHTML(),inventory.updateInventory(),inventory.updateEquipment(),i.gameSpeed(1e3),f=!0},t=function(){document.getElementById("idleSwitch").innerHTML=g?'<button class="btn btn-success" onClick="system.toggleIdle()">Idle ON</button>':'<button class="btn btn-danger" onClick="system.toggleIdle()">Idle OFF</button>'}};$.get("https://raw.githubusercontent.com/iCrawlerRPG/iCrawlerRPG.github.io/master/CHANGELOG.md",function(a){var b=new showdown.Converter,c=a,d=b.makeHtml(c);$("#changelog").html(d)});var system=new System;system.runGame();var Tower=function(){for(var a=0,b=!1,c=[],d=0;d<monsters.getMonsterList().length;d++)0===d?c.push({size:100,explored:100,canAdvance:!0,stairsPosition:0,monsterDensity:0}):c.push({size:Math.floor(2*c[d-1].size),explored:0,canAdvance:!1,stairsPosition:Math.floor(Math.random()*Math.floor(2*c[d-1].size)),monsterDensity:Math.floor(10+40*Math.random())});var e=this;e.save=function(){var d={savedFloors:c,savedLastBossDefeated:a,savedBossFound:b};localStorage.setItem("towerSave",JSON.stringify(d))},e.load=function(){var c=JSON.parse(localStorage.getItem("towerSave"));c&&(void 0!==c.savedFloors&&f(c.savedFloors),void 0!==c.savedLastBossDefeated&&(a=c.savedLastBossDefeated),void 0!==c.savedBossFound&&(b=c.savedBossFound))};var f=function(a){for(var b=0;b<a.length&&b!=c.length;b++)void 0!==a[b].explored&&(c[b].explored=a[b].explored),void 0!==a[b].canAdvance&&(c[b].canAdvance=a[b].canAdvance),void 0!==a[b].stairsPosition&&(c[b].stairsPosition=a[b].stairsPosition),void 0!==a[b].monsterDensity&&(c[b].monsterDensity=a[b].monsterDensity)};e.getFloorMonsterDensity=function(a){return c[a].monsterDensity},e.getMaxFloor=function(){for(var a=0,b=0;b<c.length;b++)c[b].explored===c[b].size&&(a=b);return a},e.setBossFound=function(a){b=a},e.setLastBossDefeated=function(b){a=b},e.floorExplorationComplete=function(a){return c[a].size==c[a].explored},e.loadTowerScreen=function(){var d=player.getCurrentFloor();document.getElementById("floor").innerHTML=d,document.getElementById("explperc").innerHTML=Math.round(c[d].explored/c[d].size*100*100)/100+"%",document.getElementById("floorbar").style.width=c[d].explored/c[d].size*100+"%",c[d].canAdvance&&d<monsters.getMonsterList().length?document.getElementById("advbut").innerHTML='<button class="btn btn-default btn-block" onClick="tower.changeFloor(1)">Next Floor</button>':document.getElementById("advbut").innerHTML=b?d%10!=0?'<button class="btn btn-default btn-block" onClick="tower.changeFloor(1)">Next Floor</button>':d<=a?'<button class="btn btn-default btn-block" onClick="tower.changeFloor(1)">Next Floor</button>':'<button class="btn btn-danger btn-block" onClick="tower.startBossBattle()">Fight Floor Boss</button>':"",document.getElementById("retbut").innerHTML=0!==d?'<button class="btn btn-default btn-block" onClick="tower.changeFloor(-1)">Previous Floor</button>':""},e.startBossBattle=function(){player.getInBattle()||(monsters.setInstancedMonster(monsters.getBossMonster(player.getCurrentFloor()/10-1)),monsters.setInBossBattle(!0),monsters.battle(monsters.getInstancedMonster(),!1))},e.bossDefeated=function(){c[player.getCurrentFloor()].canAdvance=!0,e.loadTowerScreen()},e.changeFloor=function(a){player.getInBattle()||(player.setCurrentFloor(player.getCurrentFloor()+a),e.loadTowerScreen(),player.loadRestButton(),player.loadExploreButton())};var g=function(a){return c[a].explored>c[a].stairsPosition};e.exploreFloor=function(){var a=player.getCurrentFloor();if(player.setManaCurrentValue(player.getManaCurrentValue()+buffs.getManaPerSecond()),e.floorExplorationComplete(a))monsters.battleChance(!0);else{var d=buffs.getExplorationSpeedMultiplier()*((player.getSpeedLevel()+player.getSpeedBonus())/10),f=c[a].size-c[a].explored;d>f&&(d=f),c[a].explored+=d,g(a)&&!c[a].canAdvance&&a<monsters.getMonsterList().length&&(a%10!=0?c[a].canAdvance=!0:b=!0),player.setSpeedExperience(player.getSpeedExperience()+5*d*buffs.getLevelingSpeedMultiplier()/buffs.getExplorationSpeedMultiplier()),e.loadTowerScreen(),h()||monsters.battleChance(!1)}};var h=function(){var a=Math.floor(100*Math.random());if(a<=10){if((a=100*Math.random())<5){var b=player.getCurrentFloor()+Math.floor(Math.random()*player.getCurrentFloor());document.getElementById("floorlog").innerHTML="You turn a corner, finding a treasure chest.",inventory.findChest(b)}else{var c=Math.round(50*Math.random()*player.getCurrentFloor())+1;document.getElementById("floorlog").innerHTML="You find the body of another adventurer. You check their pockets, obtaining "+c+" gold.",inventory.setGold(inventory.getGold()+c)}return!0}return document.getElementById("floorlog").innerHTML="You walk around for a bit, finding nothing of interest.",!1}},tower=new Tower,Upgrades=function(){var a=0,b=[];b.push({name:"Aetheric Attunement 1",id:"aetheric1",exceliaCost:10,required:"",shown:!0,purchased:!1,description:"Tap into the mana around you. Recover +1 MP per second while exploring."}),b.push({name:"Time Warp 1",id:"timewarp1",exceliaCost:10,required:"",shown:!0,purchased:!1,description:"Is idle mode too slow? Make it go at twice the speed!"}),b.push({name:"Blessings 1",id:"blessings1",exceliaCost:100,required:"",shown:!0,purchased:!1,description:"Keep 10% of your excelia upon death."}),b.push({name:"Faster Resting 1",id:"fastresting1",exceliaCost:100,required:"",shown:!0,purchased:!1,description:"Recover at twice the normal speed."}),b.push({name:"Auto-Shooting",id:"autoshoot",exceliaCost:250,required:"",shown:!0,purchased:!1,description:"Shoot a fireball at the start of every battle without losing a turn!"}),b.push({name:"Battle Healing",id:"battlehealing",exceliaCost:250,required:"",shown:!0,purchased:!1,description:"Cast Cure whenever you get under 50% HP during battle."}),b.push({name:"Aetheric Attunement 2",id:"aetheric2",exceliaCost:350,required:"aetheric1",shown:!1,purchased:!1,description:"Deepen the bond between you and the flow of mana. Get +2 MP per second while exploring."}),b.push({name:"Faster Resting 2",id:"fastresting2",exceliaCost:500,required:"fastresting1",shown:!1,purchased:!1,description:"Recover at four times the normal speed."}),b.push({name:"Time Warp 2",id:"timewarp2",exceliaCost:500,required:"timewarp1",shown:!1,purchased:!1,description:"Change to the next gear! With this, idle mode is five times faster!"}),b.push({name:"Faster Exploration 1",id:"fasterexploration1",exceliaCost:1e3,required:"",shown:!0,purchased:!1,description:"Double the speed of floor exploration."}),b.push({name:"Muscle Memory 1",id:"musclememory1",exceliaCost:1e3,required:"",shown:!0,purchased:!1,description:"Lose 1% less stats when dying."}),b.push({name:"Barrier Casting",id:"barriercast",exceliaCost:2e3,required:"",shown:!0,purchased:!1,description:"Cast Barrier whenever it is down. You need the Barrier spell for it to have any effect."}),b.push({name:"Blessings 2",id:"blessings2",exceliaCost:2e3,required:"blessings1",shown:!1,purchased:!1,description:"With this, you'll be able to keep 20% of your excelia upon death!"}),b.push({name:"Double Excelia 1",id:"doubleexcelia1",exceliaCost:2e3,required:"",shown:!0,purchased:!1,description:"Double the amount of Excelia you gain per monster."}),b.push({name:"Faster Leveling 1",id:"fasterleveling1",exceliaCost:2e3,required:"",shown:!0,purchased:!1,description:"Double the speed your stats gain experience."}),b.push({name:"Time Warp 3",id:"timewarp3",exceliaCost:2e3,required:"timewarp2",shown:!1,purchased:!1,description:"Makes idle mode ten times faster! You'll barely see what's happening"}),b.push({name:"Faster Resting 3",id:"fastresting3",exceliaCost:2500,required:"fastresting2",shown:!1,purchased:!1,description:"Recover at eight times the normal speed."}),b.push({name:"Adept Mage",id:"adeptmage",exceliaCost:5e3,required:"",shown:!0,purchased:!1,description:"Master spells twice as fast."}),b.push({name:"Blessings 3",id:"blessings3",exceliaCost:5e3,required:"blessings2",shown:!1,purchased:!1,description:"Keep 30% of your excelia upon death."}),b.push({name:"Faster Exploration 1",id:"fasterexploration2",exceliaCost:5e3,required:"fasterexploration1",shown:!1,purchased:!1,description:"Double the speed of floor exploration."}),b.push({name:"Muscle Memory 2",id:"musclememory2",exceliaCost:5e3,required:"musclememory1",shown:!1,purchased:!1,description:"Lose 1% less stats when dying."}),b.push({name:"Double Excelia 2",id:"doubleexcelia2",exceliaCost:1e4,required:"doubleexcelia1",shown:!1,purchased:!1,description:"Double the amount of Excelia you gain per monster."}),b.push({name:"Faster Leveling 2",id:"fasterleveling2",exceliaCost:15e3,required:"fasterleveling1",shown:!1,purchased:!1,description:"Double the speed your stats gain experience."}),b.push({name:"Faster Exploration 1",id:"fasterexploration3",exceliaCost:2e4,required:"fasterexploration2",shown:!1,purchased:!1,description:"Double the speed of floor exploration."}),b.push({name:"Faster Leveling 3",id:"fasterleveling3",exceliaCost:5e4,required:"fasterleveling2",shown:!1,purchased:!1,description:"Double the speed your stats gain experience."});var c=this;c.save=function(){var c={savedExcelia:a,savedUpgradeList:b};localStorage.setItem("upgradesSave",JSON.stringify(c))},c.load=function(){var b=JSON.parse(localStorage.getItem("upgradesSave"));b&&(void 0!==b.savedExcelia&&(a=b.savedExcelia),void 0!==b.savedUpgradeList&&d(b.savedUpgradeList))};var d=function(a){for(var c=!1,d=0;d<a.length&&d!=b.length;d++){for(var e=0;e<b.length;e++)if(b[e].id==a[d].id){c=!0;break}c&&(void 0!==a[d].shown&&(b[e].shown=a[d].shown),void 0!==a[d].purchased&&(b[e].purchased=a[d].purchased)),c=!1}};c.getExcelia=function(){return a},c.setExcelia=function(b){a=b,c.loadExcelia()},c.loadExcelia=function(){document.getElementById("excelia").innerHTML=Math.round(100*a)/100},c.loadTimeUpgrades=function(){for(var a=0;a<b.length;a++)"timewarp1"==b[a].id&&!0===b[a].purchased?document.getElementById("speed2").innerHTML='<button class="btn btn-primary" onClick="system.gameSpeed(500)">x2</button>':"timewarp2"==b[a].id&&!0===b[a].purchased?document.getElementById("speed5").innerHTML='<button class="btn btn-primary" onClick="system.gameSpeed(200)">x5</button>':"timewarp3"==b[a].id&&!0===b[a].purchased&&(document.getElementById("speed10").innerHTML='<button class="btn btn-primary" onClick="system.gameSpeed(100)">x10</button>')},c.gainExcelia=function(a){var b=buffs.getExceliaMultiplier()*(a.strength+a.constitution+a.dexterity)/15;c.updateExcelia(b),c.updateUpgrades()},c.updateExcelia=function(b){a+=b,c.loadExcelia()},c.updateUpgrades=function(){document.getElementById("upgrades").innerHTML="";for(var a=0;a<b.length;a++)!b[a].purchased&&c.isUpgradePurchased(b[a].required)&&(b[a].shown=!0,document.getElementById("upgrades").innerHTML+='<div class="row"><div class="col-xs-7"><button class="btn btn-primary btn-block" data-toggle="tooltip" data-placement="top" title="'+b[a].description+'" onClick="upgrades.buyUpgrade(\''+b[a].id+"')\">"+b[a].name+'</button></div><div class="col-xs-5"><p>(Cost: '+b[a].exceliaCost+')</p></div></div><div class="row" style="height: 5px;"></div>');$(document).ready(function(){$('[data-toggle="tooltip"]').tooltip()})},c.isUpgradePurchased=function(a){if(""===a)return!0;for(var c=0;c<b.length;c++)if(b[c].id==a)return!!b[c].purchased;return!1},c.buyUpgrade=function(d){for(var f=0;f<b.length&&b[f].id!=d;f++);a>=b[f].exceliaCost&&(c.updateExcelia(-b[f].exceliaCost),b[f].purchased=!0,e(b[f]),c.updateUpgrades()),buffs.updatePermanentBuffs(),buffs.updateToggleableBuffs()};var e=function(a){
"timewarp1"==a.id||"timewarp2"==a.id||"timewarp3"==a.id?c.loadTimeUpgrades():"aetheric1"==a.id||"aetheric2"==a.id?buffs.setManaPerSecond(buffs.getManaPerSecond()+1):"battleHealing"==a.id?buffs.setCastCureInBattle(!0):"doubleexcelia1"==a.id||"doubleexcelia2"==a.id?buffs.setExceliaMultiplier(2*buffs.getExceliaMultiplier()):"adeptmage"==a.id?buffs.setSpellLevelingMultiplier(2*buffs.getSpellLevelingMultiplier()):"blessings1"==a.id||"blessings2"==a.id||"blessings3"==a.id?buffs.setExceliaSavedOnDeath(buffs.getExceliaSavedOnDeath()+10):"autoshoot"==a.id?buffs.setCastFireballInBattle(!0):"fastresting1"==a.id||"fastresting2"==a.id||"fastresting3"==a.id?buffs.setRestingMultiplier(2*buffs.getRestingMultiplier()):"musclememory1"==a.id||"musclememory2"==a.id?buffs.setDeathPenaltyReduction(buffs.getDeathPenaltyReduction()+1):"barriercast"==a.id?buffs.setAutoBarrierCast(!0):"fasterleveling1"==a.id||"fasterleveling2"==a.id||"fasterleveling3"==a.id?buffs.setLevelingSpeedMultiplier(2*buffs.getLevelingSpeedMultiplier()):"fasterexploration1"!=a.id&&"fasterexploration2"!=a.id&&"fasterexploration3"!=a.id||buffs.setExplorationSpeedMultiplier(2*buffs.getExplorationSpeedMultiplier())}},upgrades=new Upgrades;